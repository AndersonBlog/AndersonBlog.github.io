<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/2.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/1.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"yoursite.com","root":"/","scheme":"Gemini","version":"7.7.2","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="1.æœ¬æ–‡æ¶‰åŠåˆ°çš„çŸ¥è¯†ï¼š Jwt Tokenï¼Œsessionå’ŒcookieåŒºåˆ«  2.æ— çŠ¶æ€HTTPåè®®">
<meta property="og:type" content="article">
<meta property="og:title" content="SpringBootå®ç°åŸºäºTokençš„ç”¨æˆ·èº«ä»½éªŒè¯">
<meta property="og:url" content="http://yoursite.com/2019/10/13/SpringBoot-Token/index.html">
<meta property="og:site_name" content="é™ªä½ åº¦è¿‡æ¼«é•¿å²æœˆ">
<meta property="og:description" content="1.æœ¬æ–‡æ¶‰åŠåˆ°çš„çŸ¥è¯†ï¼š Jwt Tokenï¼Œsessionå’ŒcookieåŒºåˆ«  2.æ— çŠ¶æ€HTTPåè®®">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://yoursite.com/2019/10/13/SpringBoot-Token/jwt.png">
<meta property="og:image" content="http://yoursite.com/2019/10/13/SpringBoot-Token/%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84.PNG">
<meta property="og:image" content="http://yoursite.com/2019/10/13/SpringBoot-Token/getMessageNoToken.PNG">
<meta property="og:image" content="http://yoursite.com/2019/10/13/SpringBoot-Token/login.PNG">
<meta property="og:image" content="http://yoursite.com/2019/10/13/SpringBoot-Token/getMessageWithToken.PNG">
<meta property="article:published_time" content="2019-10-13T12:02:19.000Z">
<meta property="article:modified_time" content="2020-03-28T13:14:21.804Z">
<meta property="article:author" content="Anderson Wu">
<meta property="article:tag" content="Token JWT SpringBoot">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://yoursite.com/2019/10/13/SpringBoot-Token/jwt.png">

<link rel="canonical" href="http://yoursite.com/2019/10/13/SpringBoot-Token/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>SpringBootå®ç°åŸºäºTokençš„ç”¨æˆ·èº«ä»½éªŒè¯ | é™ªä½ åº¦è¿‡æ¼«é•¿å²æœˆ</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ ">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">é™ªä½ åº¦è¿‡æ¼«é•¿å²æœˆ</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">To be yourself</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>é¦–é¡µ</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>å…³äº</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>æ ‡ç­¾</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>åˆ†ç±»</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>å½’æ¡£</a>

  </li>
        <li class="menu-item menu-item-sitemap">

    <a href="/sitemap" rel="section"><i class="fa fa-fw fa-sitemap"></i>ç«™ç‚¹åœ°å›¾</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post">
            

  <div class="posts-expand">
      
  
  
  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/10/13/SpringBoot-Token/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/self.png">
      <meta itemprop="name" content="Anderson Wu">
      <meta itemprop="description" content="Love is love">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="é™ªä½ åº¦è¿‡æ¼«é•¿å²æœˆ">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          SpringBootå®ç°åŸºäºTokençš„ç”¨æˆ·èº«ä»½éªŒè¯
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2019-10-13 20:02:19" itemprop="dateCreated datePublished" datetime="2019-10-13T20:02:19+08:00">2019-10-13</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2020-03-28 21:14:21" itemprop="dateModified" datetime="2020-03-28T21:14:21+08:00">2020-03-28</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/SpringBoot/" itemprop="url" rel="index"><span itemprop="name">SpringBoot</span></a>
                </span>
            </span>
		 

          
		  
		  
		
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°ï¼š</span>
              <span id="busuanzi_value_page_pv"></span>
            <span class="post-meta-item" title="é˜…è¯»æ¬¡æ•°" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°ï¼š</span>
              <span id="busuanzi_value_page_pv"></span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h5 id="1-æœ¬æ–‡æ¶‰åŠåˆ°çš„çŸ¥è¯†ï¼š"><a href="#1-æœ¬æ–‡æ¶‰åŠåˆ°çš„çŸ¥è¯†ï¼š" class="headerlink" title="1.æœ¬æ–‡æ¶‰åŠåˆ°çš„çŸ¥è¯†ï¼š"></a>1.æœ¬æ–‡æ¶‰åŠåˆ°çš„çŸ¥è¯†ï¼š</h5><ul>
<li>Jwt</li>
<li>Tokenï¼Œsessionå’ŒcookieåŒºåˆ«</li>
</ul>
<h5 id="2-æ— çŠ¶æ€HTTPåè®®"><a href="#2-æ— çŠ¶æ€HTTPåè®®" class="headerlink" title="2.æ— çŠ¶æ€HTTPåè®®"></a>2.æ— çŠ¶æ€HTTPåè®®</h5><a id="more"></a>

<p>â€‹        ç”±äºHTTPæ˜¯ä¸€ç§æ²¡æœ‰çŠ¶æ€çš„é€šä¿¡åè®®ï¼ŒæœåŠ¡å™¨æ— æ³•è®°å½•å®¢æˆ·ç«¯çš„ç™»å½•çŠ¶æ€ä¿¡æ¯ï¼Œå½“å®¢æˆ·ç«¯é‡æ–°ç™»å½•æœåŠ¡å™¨éœ€è¦å†ä¸€æ¬¡è¿›è¡Œèº«ä»½è®¤è¯ï¼Œè¿™æ ·å¸¦æ¥ä¸å¥½çš„ç”¨æˆ·ä½“éªŒã€‚</p>
<p>â€‹        ç”¨æˆ·çš„ç™»å½•çŠ¶æ€ä¿¡æ¯å¯ä»¥ä¿å­˜åœ¨æœåŠ¡å™¨æˆ–å®¢æˆ·ç«¯ï¼Œ</p>
<h5 id="3-Tokenï¼Ÿä¸ºä»€ä¹ˆéœ€è¦Tokenï¼Ÿ"><a href="#3-Tokenï¼Ÿä¸ºä»€ä¹ˆéœ€è¦Tokenï¼Ÿ" class="headerlink" title="3.Tokenï¼Ÿä¸ºä»€ä¹ˆéœ€è¦Tokenï¼Ÿ"></a>3.Tokenï¼Ÿä¸ºä»€ä¹ˆéœ€è¦Tokenï¼Ÿ</h5><p>å¯ä»¥å‚è€ƒ<a href="https://andersonblog.github.io/2019/09/27/æµ…æcookie-session-token/" target="_blank" rel="noopener">cookie, sessionå’ŒtokenåŒºåˆ«</a>ï¼Œä»¥åŠä¸ºä»€ä¹ˆä½¿ç”¨tokenã€‚</p>
<h5 id="4-JWT"><a href="#4-JWT" class="headerlink" title="4. JWT"></a>4. JWT</h5><p>â€‹       <strong>Json web token (JWT)</strong>, æ˜¯ä¸ºäº†åœ¨ç½‘ç»œåº”ç”¨ç¯å¢ƒé—´ä¼ é€’å£°æ˜è€Œæ‰§è¡Œçš„ä¸€ç§åŸºäº<code>JSON</code>çš„å¼€æ”¾æ ‡å‡†ï¼ˆ(RFC 7519).<strong>å®šä¹‰äº†ä¸€ç§ç®€æ´çš„ï¼Œè‡ªåŒ…å«çš„æ–¹æ³•ç”¨äºé€šä¿¡åŒæ–¹ä¹‹é—´ä»¥JSONå¯¹è±¡çš„å½¢å¼å®‰å…¨çš„ä¼ é€’ä¿¡æ¯ã€‚</strong>å› ä¸ºæ•°å­—ç­¾åçš„å­˜åœ¨ï¼Œè¿™äº›ä¿¡æ¯æ˜¯å¯ä¿¡çš„ï¼Œ<strong>JWTå¯ä»¥ä½¿ç”¨HMACç®—æ³•æˆ–è€…æ˜¯RSAçš„å…¬ç§ç§˜é’¥å¯¹è¿›è¡Œç­¾åã€‚</strong></p>
<p>JWTè¯·æ±‚æµç¨‹ï¼š</p>
<p><img src="/2019/10/13/SpringBoot-Token/jwt.png" alt></p>
<ol>
<li>ç”¨æˆ·ä½¿ç”¨è´¦å·å’Œé¢å‘å‡ºpostè¯·æ±‚ï¼›</li>
<li>æœåŠ¡å™¨ä½¿ç”¨ç§é’¥åˆ›å»ºä¸€ä¸ªjwtï¼›</li>
<li>æœåŠ¡å™¨è¿”å›è¿™ä¸ªjwtç»™æµè§ˆå™¨ï¼›</li>
<li>æµè§ˆå™¨å°†è¯¥jwtä¸²åœ¨è¯·æ±‚å¤´ä¸­åƒæœåŠ¡å™¨å‘é€è¯·æ±‚ï¼›</li>
<li>æœåŠ¡å™¨éªŒè¯è¯¥jwtï¼›</li>
<li>è¿”å›å“åº”çš„èµ„æºç»™æµè§ˆå™¨ã€‚</li>
</ol>
<p><strong>JWTçš„ä¸»è¦åº”ç”¨åœºæ™¯</strong></p>
<p>â€‹         èº«ä»½è®¤è¯åœ¨è¿™ç§åœºæ™¯ä¸‹ï¼Œä¸€æ—¦ç”¨æˆ·å®Œæˆäº†ç™»é™†ï¼Œåœ¨æ¥ä¸‹æ¥çš„æ¯ä¸ªè¯·æ±‚ä¸­åŒ…å«JWTï¼Œ<strong>å¯ä»¥ç”¨æ¥éªŒè¯ç”¨æˆ·èº«ä»½ä»¥åŠå¯¹è·¯ç”±ï¼ŒæœåŠ¡å’Œèµ„æºçš„è®¿é—®æƒé™è¿›è¡ŒéªŒè¯ã€‚</strong>ç”±äºå®ƒçš„å¼€é”€éå¸¸å°ï¼Œå¯ä»¥è½»æ¾çš„åœ¨ä¸åŒåŸŸåçš„ç³»ç»Ÿä¸­ä¼ é€’ï¼Œæ‰€æœ‰ç›®å‰åœ¨<strong>å•ç‚¹ç™»å½•ï¼ˆSSOï¼‰</strong>ä¸­æ¯”è¾ƒå¹¿æ³›çš„ä½¿ç”¨äº†è¯¥æŠ€æœ¯ã€‚ ä¿¡æ¯äº¤æ¢åœ¨é€šä¿¡çš„åŒæ–¹ä¹‹é—´ä½¿ç”¨JWTå¯¹æ•°æ®è¿›è¡Œç¼–ç æ˜¯ä¸€ç§éå¸¸å®‰å…¨çš„æ–¹å¼ï¼Œ<strong>ç”±äºå®ƒçš„ä¿¡æ¯æ˜¯ç»è¿‡ç­¾åçš„ï¼Œå¯ä»¥ç¡®ä¿å‘é€è€…å‘é€çš„ä¿¡æ¯æ˜¯æ²¡æœ‰ç»è¿‡ä¼ªé€ çš„ã€‚</strong></p>
<p><strong>ä¼˜ç‚¹</strong></p>
<ol>
<li><p>ç®€æ´(Compact): å¯ä»¥é€šè¿‡URLï¼ŒPOSTå‚æ•°æˆ–è€…åœ¨HTTP headerå‘é€ï¼Œå› ä¸ºæ•°æ®é‡å°ï¼Œä¼ è¾“é€Ÿåº¦ä¹Ÿå¾ˆå¿«</p>
</li>
<li><p>è‡ªåŒ…å«(Self-contained)ï¼šè´Ÿè½½ä¸­åŒ…å«äº†æ‰€æœ‰ç”¨æˆ·æ‰€éœ€è¦çš„ä¿¡æ¯ï¼Œé¿å…äº†å¤šæ¬¡æŸ¥è¯¢æ•°æ®åº“</p>
</li>
<li><p>å› ä¸ºTokenæ˜¯ä»¥JSONåŠ å¯†çš„å½¢å¼ä¿å­˜åœ¨å®¢æˆ·ç«¯çš„ï¼Œæ‰€ä»¥JWTæ˜¯è·¨è¯­è¨€çš„ï¼ŒåŸåˆ™ä¸Šä»»ä½•webå½¢å¼éƒ½æ”¯æŒã€‚</p>
</li>
<li><p>ä¸éœ€è¦åœ¨æœåŠ¡ç«¯ä¿å­˜ä¼šè¯ä¿¡æ¯ï¼Œç‰¹åˆ«é€‚ç”¨äºåˆ†å¸ƒå¼å¾®æœåŠ¡ã€‚</p>
</li>
</ol>
<p><strong>JWTçš„ç»“æ„</strong></p>
<p><strong>JWTæ˜¯ç”±ä¸‰æ®µä¿¡æ¯æ„æˆçš„ï¼Œå°†è¿™ä¸‰æ®µä¿¡æ¯æ–‡æœ¬ç”¨.è¿æ¥ä¸€èµ·å°±æ„æˆäº†JWTå­—ç¬¦ä¸²ã€‚</strong><br>å°±åƒè¿™æ ·:<br><code>eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiYWRtaW4iOnRydWV9.TJVA95OrM7E2cBab30RMHrHDcEfxjoYZgeFONFh7HgQ</code></p>
<p><strong>JWTåŒ…å«äº†ä¸‰éƒ¨åˆ†ï¼š</strong></p>
<ul>
<li>Header å¤´éƒ¨(æ ‡é¢˜åŒ…å«äº†ä»¤ç‰Œçš„å…ƒæ•°æ®ï¼Œå¹¶ä¸”åŒ…å«ç­¾åå’Œ/æˆ–åŠ å¯†ç®—æ³•çš„ç±»å‹)</li>
<li>Payload è´Ÿè½½ (ç±»ä¼¼äºé£æœºä¸Šæ‰¿è½½çš„ç‰©å“)</li>
<li>Signature ç­¾å/ç­¾è¯</li>
</ul>
<p><strong>Header</strong></p>
<p><strong>JWTçš„å¤´éƒ¨æ‰¿è½½ä¸¤éƒ¨åˆ†ä¿¡æ¯ï¼štokenç±»å‹å’Œé‡‡ç”¨çš„åŠ å¯†ç®—æ³•ã€‚</strong></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123; </span><br><span class="line">  <span class="attr">"alg"</span>: <span class="string">"HS256"</span>,</span><br><span class="line">   <span class="attr">"typ"</span>: <span class="string">"JWT"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>å£°æ˜ç±»å‹:è¿™é‡Œæ˜¯jwt</strong></p>
<p><strong>å£°æ˜åŠ å¯†çš„ç®—æ³•:é€šå¸¸ç›´æ¥ä½¿ç”¨ HMAC SHA256</strong></p>
<p><strong>åŠ å¯†ç®—æ³•æ˜¯å•å‘å‡½æ•°æ•£åˆ—ç®—æ³•ï¼Œå¸¸è§çš„æœ‰MD5ã€SHAã€HAMCã€‚</strong></p>
<ul>
<li>MD5(message-digest algorithm 5) ï¼ˆä¿¡æ¯-æ‘˜è¦ç®—æ³•ï¼‰ç¼©å†™ï¼Œå¹¿æ³›ç”¨äºåŠ å¯†å’Œè§£å¯†æŠ€æœ¯ï¼Œå¸¸ç”¨äºæ–‡ä»¶æ ¡éªŒã€‚æ ¡éªŒï¼Ÿä¸ç®¡æ–‡ä»¶å¤šå¤§ï¼Œç»è¿‡MD5åéƒ½èƒ½ç”Ÿæˆå”¯ä¸€çš„MD5å€¼</li>
<li>SHA (Secure Hash Algorithmï¼Œå®‰å…¨æ•£åˆ—ç®—æ³•ï¼‰ï¼Œæ•°å­—ç­¾åç­‰å¯†ç å­¦åº”ç”¨ä¸­é‡è¦çš„å·¥å…·ï¼Œå®‰å…¨æ€§é«˜äºMD5</li>
<li>HMAC (Hash Message Authentication Code)ï¼Œæ•£åˆ—æ¶ˆæ¯é‰´åˆ«ç ï¼ŒåŸºäºå¯†é’¥çš„Hashç®—æ³•çš„è®¤è¯åè®®ã€‚ç”¨å…¬å¼€å‡½æ•°å’Œå¯†é’¥äº§ç”Ÿä¸€ä¸ªå›ºå®šé•¿åº¦çš„å€¼ä½œä¸ºè®¤è¯æ ‡è¯†ï¼Œç”¨è¿™ä¸ªæ ‡è¯†é‰´åˆ«æ¶ˆæ¯çš„å®Œæ•´æ€§ã€‚å¸¸ç”¨äºæ¥å£ç­¾åéªŒè¯</li>
</ul>
<p><strong>Payload</strong></p>
<p>è½½è·å°±æ˜¯å­˜æ”¾æœ‰æ•ˆä¿¡æ¯çš„åœ°æ–¹ã€‚<br><strong>æœ‰æ•ˆä¿¡æ¯åŒ…å«ä¸‰ä¸ªéƒ¨åˆ†</strong></p>
<ol>
<li><p>æ ‡å‡†ä¸­æ³¨å†Œçš„å£°æ˜</p>
</li>
<li><p>å…¬å…±çš„å£°æ˜</p>
</li>
<li><p>ç§æœ‰çš„å£°æ˜</p>
<p><strong>æ ‡å‡†ä¸­æ³¨å†Œçš„å£°æ˜ (å»ºè®®ä½†ä¸å¼ºåˆ¶ä½¿ç”¨) ï¼š</strong></p>
</li>
</ol>
<ul>
<li><p>iss: jwtç­¾å‘è€…</p>
</li>
<li><p>sub: é¢å‘çš„ç”¨æˆ·(jwtæ‰€é¢å‘çš„ç”¨æˆ·)</p>
</li>
<li><p>aud: æ¥æ”¶jwtçš„ä¸€æ–¹</p>
</li>
<li><p>exp: è¿‡æœŸæ—¶é—´æˆ³(jwtçš„è¿‡æœŸæ—¶é—´ï¼Œè¿™ä¸ªè¿‡æœŸæ—¶é—´å¿…é¡»è¦å¤§äºç­¾å‘æ—¶é—´)</p>
</li>
<li><p>nbf: å®šä¹‰åœ¨ä»€ä¹ˆæ—¶é—´ä¹‹å‰ï¼Œè¯¥jwtéƒ½æ˜¯ä¸å¯ç”¨çš„.</p>
</li>
<li><p>iat: jwtçš„ç­¾å‘æ—¶é—´jti: jwtçš„å”¯ä¸€èº«ä»½æ ‡è¯†ï¼Œä¸»è¦ç”¨æ¥ä½œä¸ºä¸€æ¬¡æ€§</p>
</li>
<li><p>token,ä»è€Œå›é¿é‡æ”¾æ”»å‡»ã€‚</p>
<p><strong>å…¬å…±çš„å£°æ˜ ï¼š</strong></p>
</li>
</ul>
<p>å…¬å…±çš„å£°æ˜å¯ä»¥æ·»åŠ ä»»ä½•çš„ä¿¡æ¯ï¼Œä¸€èˆ¬æ·»åŠ ç”¨æˆ·çš„ç›¸å…³ä¿¡æ¯æˆ–å…¶ä»–ä¸šåŠ¡éœ€è¦çš„å¿…è¦ä¿¡æ¯.ä½†ä¸å»ºè®®æ·»åŠ æ•æ„Ÿä¿¡æ¯ï¼Œå› ä¸ºè¯¥éƒ¨åˆ†åœ¨å®¢æˆ·ç«¯å¯è§£å¯†.</p>
<p><strong>ç§æœ‰çš„å£°æ˜ ï¼š</strong></p>
<p>ç§æœ‰å£°æ˜æ˜¯æä¾›è€…å’Œæ¶ˆè´¹è€…æ‰€å…±åŒå®šä¹‰çš„å£°æ˜ï¼Œä¸€èˆ¬ä¸å»ºè®®å­˜æ”¾æ•æ„Ÿä¿¡æ¯ï¼Œå› ä¸ºbase64æ˜¯å¯¹ç§°è§£å¯†çš„ï¼Œæ„å‘³ç€è¯¥éƒ¨åˆ†ä¿¡æ¯å¯ä»¥å½’ç±»ä¸ºæ˜æ–‡ä¿¡æ¯ã€‚</p>
<p><strong>Signature</strong></p>
<p><strong>jwtçš„ç¬¬ä¸‰éƒ¨åˆ†æ˜¯ä¸€ä¸ªç­¾è¯ä¿¡æ¯ï¼Œè¿™ä¸ªç­¾è¯ä¿¡æ¯ç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼š</strong></p>
<ul>
<li><p>header (base64åçš„)</p>
</li>
<li><p>payload (base64åçš„)</p>
</li>
<li><p>secret</p>
</li>
</ul>
<p>â€‹        è¿™ä¸ªéƒ¨åˆ†éœ€è¦base64åŠ å¯†åçš„headerå’Œbase64åŠ å¯†åçš„payloadä½¿ç”¨ . è¿æ¥ç»„æˆçš„å­—ç¬¦ä¸²ï¼Œç„¶åé€šè¿‡headerä¸­å£°æ˜çš„åŠ å¯†æ–¹å¼è¿›è¡ŒåŠ ç›secretç»„åˆåŠ å¯†ï¼Œç„¶åå°±æ„æˆäº†jwtçš„ç¬¬ä¸‰éƒ¨åˆ†ã€‚<br>å¯†é’¥secretæ˜¯ä¿å­˜åœ¨æœåŠ¡ç«¯çš„ï¼ŒæœåŠ¡ç«¯ä¼šæ ¹æ®è¿™ä¸ªå¯†é’¥è¿›è¡Œç”Ÿæˆtokenå’Œè¿›è¡ŒéªŒè¯ï¼Œæ‰€ä»¥éœ€è¦ä¿æŠ¤å¥½ã€‚</p>
<h5 id="5-é¡¹ç›®"><a href="#5-é¡¹ç›®" class="headerlink" title="5.é¡¹ç›®"></a>5.é¡¹ç›®</h5><h6 id="é¡¹ç›®ç»“æ„"><a href="#é¡¹ç›®ç»“æ„" class="headerlink" title="é¡¹ç›®ç»“æ„"></a>é¡¹ç›®ç»“æ„</h6><p><img src="/2019/10/13/SpringBoot-Token/%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84.PNG" alt></p>
<h6 id="é¡¹ç›®ä¾èµ–ï¼š"><a href="#é¡¹ç›®ä¾èµ–ï¼š" class="headerlink" title="é¡¹ç›®ä¾èµ–ï¼š"></a>é¡¹ç›®ä¾èµ–ï¼š</h6><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.auth0<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>java-jwt<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">version</span>&gt;</span>3.4.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.37<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">version</span>&gt;</span>1.3.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>fastjson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.47<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">version</span>&gt;</span>1.16.22<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="6-å®ç°æ­¥éª¤"><a href="#6-å®ç°æ­¥éª¤" class="headerlink" title="6.å®ç°æ­¥éª¤"></a>6.å®ç°æ­¥éª¤</h5><h6 id="6-1-è‡ªå®šä¹‰ä¸¤ä¸ªæ³¨è§£"><a href="#6-1-è‡ªå®šä¹‰ä¸¤ä¸ªæ³¨è§£" class="headerlink" title="6.1 è‡ªå®šä¹‰ä¸¤ä¸ªæ³¨è§£"></a>6.1 è‡ªå®šä¹‰ä¸¤ä¸ªæ³¨è§£</h6><p><strong>ç”¨æ¥è·³è¿‡éªŒè¯çš„PassToken</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target</span>(&#123;ElementType.METHOD, ElementType.TYPE&#125;)</span><br><span class="line"><span class="meta">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> PassToken &#123;</span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">required</span><span class="params">()</span> <span class="keyword">default</span> <span class="keyword">true</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>éœ€è¦ç™»å½•æ‰èƒ½è¿›è¡Œæ“ä½œçš„æ³¨è§£UserLoginToken</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target</span>(&#123;ElementType.METHOD, ElementType.TYPE&#125;)</span><br><span class="line"><span class="meta">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> UserLoginToken &#123;</span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">required</span><span class="params">()</span> <span class="keyword">default</span> <span class="keyword">true</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>@Target</code>:æ³¨è§£çš„ä½œç”¨ç›®æ ‡</p>
<p>@Target(ElementType.TYPE)â€”â€”æ¥å£ã€ç±»ã€æšä¸¾ã€æ³¨è§£</p>
<p>@Target(ElementType.FIELD)â€”â€”å­—æ®µã€æšä¸¾çš„å¸¸é‡</p>
<p>@Target(ElementType.METHOD)â€”â€”æ–¹æ³•</p>
<p>@Target(ElementType.PARAMETER)â€”â€”æ–¹æ³•å‚æ•°</p>
<p>@Target(ElementType.CONSTRUCTOR) â€”â€”æ„é€ å‡½æ•°</p>
<p>@Target(ElementType.LOCAL_VARIABLE)â€”â€”å±€éƒ¨å˜é‡</p>
<p>@Target(ElementType.ANNOTATION_TYPE)â€”â€”æ³¨è§£</p>
<p>@Target(ElementType.PACKAGE)â€”â€”åŒ…</p>
<p><code>@Retention</code>ï¼šæ³¨è§£çš„ä¿ç•™ä½ç½®**</p>
<p>RetentionPolicy.SOURCE:è¿™ç§ç±»å‹çš„Annotationsåªåœ¨æºä»£ç çº§åˆ«ä¿ç•™,ç¼–è¯‘æ—¶å°±ä¼šè¢«å¿½ç•¥,åœ¨classå­—èŠ‚ç æ–‡ä»¶ä¸­ä¸åŒ…å«ã€‚</p>
<p>RetentionPolicy.CLASS:è¿™ç§ç±»å‹çš„Annotationsç¼–è¯‘æ—¶è¢«ä¿ç•™,é»˜è®¤çš„ä¿ç•™ç­–ç•¥,åœ¨classæ–‡ä»¶ä¸­å­˜åœ¨,ä½†JVMå°†ä¼šå¿½ç•¥,è¿è¡Œæ—¶æ— æ³•è·å¾—ã€‚</p>
<p>RetentionPolicy.RUNTIME:è¿™ç§ç±»å‹çš„Annotationså°†è¢«JVMä¿ç•™,æ‰€ä»¥ä»–ä»¬èƒ½åœ¨è¿è¡Œæ—¶è¢«JVMæˆ–å…¶ä»–ä½¿ç”¨åå°„æœºåˆ¶çš„ä»£ç æ‰€è¯»å–å’Œä½¿ç”¨ã€‚<br>@Documentï¼šè¯´æ˜è¯¥æ³¨è§£å°†è¢«åŒ…å«åœ¨javadocä¸­</p>
<p>@Inheritedï¼šè¯´æ˜å­ç±»å¯ä»¥ç»§æ‰¿çˆ¶ç±»ä¸­çš„è¯¥æ³¨è§£***</p>
<h6 id="6-2-å®ä½“ç±»"><a href="#6-2-å®ä½“ç±»" class="headerlink" title="6.2 å®ä½“ç±»"></a>6.2 å®ä½“ç±»</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String Id;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">	...	<span class="comment">//çœç•¥setå’Œgetæ–¹æ³•ï¼Œæˆ–è€…å¯ä»¥ä½¿ç”¨lombokç®€åŒ–å®ä½“ç±»çš„ç¼–å†™</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="6-3-è¿”å›ä½“"><a href="#6-3-è¿”å›ä½“" class="headerlink" title="6.3 è¿”å›ä½“"></a>6.3 è¿”å›ä½“</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Builder</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ResponseTemplate</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> Integer code;</span><br><span class="line">    <span class="keyword">public</span> String message;</span><br><span class="line">    <span class="keyword">public</span> Object data;</span><br><span class="line">	...	<span class="comment">//çœç•¥setå’Œgetæ–¹æ³•ï¼Œæˆ–è€…å¯ä»¥ä½¿ç”¨lombokç®€åŒ–å®ä½“ç±»çš„ç¼–å†™</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨äº†@Bulideæ³¨è§£åï¼Œå°±å¯ä»¥ä½¿ç”¨é“¾å¼é£æ ¼ä¼˜é›…åœ°åˆ›å»ºå¯¹è±¡ï¼Œæ¯”å¦‚ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ResponseTemplate.builder().code(<span class="number">200</span>).message(<span class="string">"æµ‹è¯•æˆåŠŸ"</span>).data(<span class="string">"æµ‹è¯•ğŸ“•"</span>).build();</span><br></pre></td></tr></table></figure>

<h6 id="6-4åˆ›å»ºä¸€ä¸ªæ‹¦æˆªå™¨é…ç½®ï¼Œç”¨äºæ‹¦æˆªå‰ç«¯è¯·æ±‚ï¼Œå®ç°-WebMvcConfigurer-æ¥å£"><a href="#6-4åˆ›å»ºä¸€ä¸ªæ‹¦æˆªå™¨é…ç½®ï¼Œç”¨äºæ‹¦æˆªå‰ç«¯è¯·æ±‚ï¼Œå®ç°-WebMvcConfigurer-æ¥å£" class="headerlink" title="6.4åˆ›å»ºä¸€ä¸ªæ‹¦æˆªå™¨é…ç½®ï¼Œç”¨äºæ‹¦æˆªå‰ç«¯è¯·æ±‚ï¼Œå®ç° WebMvcConfigurer æ¥å£"></a>6.4åˆ›å»ºä¸€ä¸ªæ‹¦æˆªå™¨é…ç½®ï¼Œç”¨äºæ‹¦æˆªå‰ç«¯è¯·æ±‚ï¼Œå®ç° WebMvcConfigurer æ¥å£</h6><ul>
<li>é‡å†™addHandlerInterceptionæ–¹æ³•ï¼Œå°†ç™»å½•æ‹¦æˆªå™¨æ³¨å†Œåˆ°web mvcé…ç½®ä¸­ï¼ŒæŒ‡æ˜æ‹¦æˆªçš„URL</li>
<li>åœ¨é…ç½®ç±»ä¸Šæ·»åŠ äº†æ³¨è§£@Configurationï¼Œæ ‡æ˜äº†è¯¥ç±»æ˜¯ä¸€ä¸ªé…ç½®ç±»å¹¶ä¸”ä¼šå°†è¯¥ç±»ä½œä¸ºä¸€ä¸ªSpringBeanæ·»åŠ åˆ°IOCå®¹å™¨å†…</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">InterceptorConfig</span> <span class="keyword">implements</span> <span class="title">WebMvcConfigurer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> </span>&#123;</span><br><span class="line">        registry.addInterceptor(authenticationInterceptor()).addPathPatterns(<span class="string">"/**"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> AuthenticationInterceptor <span class="title">authenticationInterceptor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> AuthenticationInterceptor();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>â€‹         InterceptorRegistryå†…çš„addInterceptoréœ€è¦ä¸€ä¸ªå®ç°HandlerInterceptoræ¥å£çš„æ‹¦æˆªå™¨å®ä¾‹ï¼ŒaddPathPatternsæ–¹æ³•ç”¨äºè®¾ç½®æ‹¦æˆªå™¨çš„è¿‡æ»¤è·¯å¾„è§„åˆ™ã€‚<br>è¿™é‡Œéœ€è¦æ‹¦æˆªæ‰€æœ‰è¯·æ±‚ï¼Œé€šè¿‡åˆ¤æ–­æ˜¯å¦æœ‰@UserLoginTokenæ³¨è§£ å†³å®šæ˜¯å¦éœ€è¦ç™»å½•</p>
<h6 id="6-5-åˆ›å»ºä¸€ä¸ªæ‹¦æˆªå™¨ï¼Œç»§æ‰¿HandlerInterceptionæ¥å£ï¼Œå®ç°æ‹¦æˆªè¿˜æ˜¯æ”¾é€šçš„é€»è¾‘ï¼Œæ‹¦æˆªåéœ€è¦è·å–tokenå¹¶æ ¡éªŒ"><a href="#6-5-åˆ›å»ºä¸€ä¸ªæ‹¦æˆªå™¨ï¼Œç»§æ‰¿HandlerInterceptionæ¥å£ï¼Œå®ç°æ‹¦æˆªè¿˜æ˜¯æ”¾é€šçš„é€»è¾‘ï¼Œæ‹¦æˆªåéœ€è¦è·å–tokenå¹¶æ ¡éªŒ" class="headerlink" title="6.5 åˆ›å»ºä¸€ä¸ªæ‹¦æˆªå™¨ï¼Œç»§æ‰¿HandlerInterceptionæ¥å£ï¼Œå®ç°æ‹¦æˆªè¿˜æ˜¯æ”¾é€šçš„é€»è¾‘ï¼Œæ‹¦æˆªåéœ€è¦è·å–tokenå¹¶æ ¡éªŒ"></a>6.5 åˆ›å»ºä¸€ä¸ªæ‹¦æˆªå™¨ï¼Œç»§æ‰¿HandlerInterceptionæ¥å£ï¼Œå®ç°æ‹¦æˆªè¿˜æ˜¯æ”¾é€šçš„é€»è¾‘ï¼Œæ‹¦æˆªåéœ€è¦è·å–tokenå¹¶æ ¡éªŒ</h6><p><strong>HandlerInterceptoræ¥å£ä¸»è¦å®šä¹‰äº†ä¸‰ä¸ªæ–¹æ³•</strong></p>
<ol>
<li><p>boolean preHandle (HttpServletRequest request, HttpServletResponse response, Object handler)ï¼š</p>
<p>é¢„å¤„ç†å›è°ƒæ–¹æ³•,å®ç°å¤„ç†å™¨çš„é¢„å¤„ç†ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°ä¸ºå“åº”çš„å¤„ç†å™¨,è‡ªå®šä¹‰Controller,è¿”å›å€¼ä¸ºtrueè¡¨ç¤ºç»§ç»­æµç¨‹ï¼ˆå¦‚è°ƒç”¨ä¸‹ä¸€ä¸ªæ‹¦æˆªå™¨æˆ–å¤„ç†å™¨ï¼‰æˆ–è€…æ¥ç€æ‰§è¡ŒpostHandle()å’ŒafterCompletion()ï¼›falseè¡¨ç¤ºæµç¨‹ä¸­æ–­ï¼Œä¸ä¼šç»§ç»­è°ƒç”¨å…¶ä»–çš„æ‹¦æˆªå™¨æˆ–å¤„ç†å™¨ï¼Œä¸­æ–­æ‰§è¡Œã€‚</p>
</li>
<li><p>void postHandle()ï¼š</p>
<p>åå¤„ç†å›è°ƒæ–¹æ³•ï¼Œå®ç°å¤„ç†å™¨çš„åå¤„ç†ï¼ˆDispatcherServletè¿›è¡Œè§†å›¾è¿”å›æ¸²æŸ“ä¹‹å‰è¿›è¡Œè°ƒç”¨ï¼‰ï¼Œæ­¤æ—¶æˆ‘ä»¬å¯ä»¥é€šè¿‡modelAndViewï¼ˆæ¨¡å‹å’Œè§†å›¾å¯¹è±¡ï¼‰å¯¹æ¨¡å‹æ•°æ®è¿›è¡Œå¤„ç†æˆ–å¯¹è§†å›¾è¿›è¡Œå¤„ç†ï¼ŒmodelAndViewä¹Ÿå¯èƒ½ä¸ºnullã€‚</p>
</li>
<li><p>void afterCompletion():</p>
<p>æ•´ä¸ªè¯·æ±‚å¤„ç†å®Œæ¯•å›è°ƒæ–¹æ³•,è¯¥æ–¹æ³•ä¹Ÿæ˜¯éœ€è¦å½“å‰å¯¹åº”çš„Interceptorçš„preHandle()çš„è¿”å›å€¼ä¸ºtrueæ—¶æ‰ä¼šæ‰§è¡Œï¼Œä¹Ÿå°±æ˜¯åœ¨DispatcherServletæ¸²æŸ“äº†å¯¹åº”çš„è§†å›¾ä¹‹åæ‰§è¡Œã€‚ç”¨äºè¿›è¡Œèµ„æºæ¸…ç†ã€‚æ•´ä¸ªè¯·æ±‚å¤„ç†å®Œæ¯•å›è°ƒæ–¹æ³•ã€‚å¦‚æ€§èƒ½ç›‘æ§ä¸­æˆ‘ä»¬å¯ä»¥åœ¨æ­¤è®°å½•ç»“æŸæ—¶é—´å¹¶è¾“å‡ºæ¶ˆè€—æ—¶é—´ï¼Œè¿˜å¯ä»¥è¿›è¡Œä¸€äº›èµ„æºæ¸…ç†ï¼Œç±»ä¼¼äºtry-catch-finallyä¸­çš„finallyï¼Œä½†ä»…è°ƒç”¨å¤„ç†å™¨æ‰§è¡Œé“¾ä¸­</p>
<p>é‡å†™preHandleræ–¹æ³•ï¼Œè¿”å›ç±»å‹ä¸ºå¸ƒå°”å‹ï¼Œtrueä»£è¡¨æ”¾è¡Œï¼Œfalseä»£è¡¨ä¸æ”¾è¡Œï¼Œä¸»è¦æµç¨‹å¦‚ä¸‹ï¼š</p>
</li>
</ol>
<ul>
<li>ä» http è¯·æ±‚å¤´ä¸­å–å‡º token</li>
<li>åˆ¤æ–­æ˜¯å¦æ˜ å°„åˆ°æ–¹æ³•ï¼Œå¦‚æœä¸æ˜¯æ˜ å°„åˆ°æ–¹æ³•ç›´æ¥é€šè¿‡</li>
<li>æ£€æŸ¥æ˜¯å¦æœ‰passtokenæ³¨é‡Šï¼Œæœ‰åˆ™è·³è¿‡è®¤è¯</li>
<li>æ£€æŸ¥æœ‰æ²¡æœ‰éœ€è¦ç”¨æˆ·ç™»å½•çš„æ³¨è§£ï¼Œæœ‰åˆ™éœ€è¦å–å‡ºå¹¶éªŒè¯</li>
<li>è®¤è¯é€šè¿‡åˆ™å¯ä»¥è®¿é—®ï¼Œä¸é€šè¿‡ä¼šæŠ¥ç›¸å…³é”™è¯¯ä¿¡æ¯</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AuthenticationInterceptor</span> <span class="keyword">implements</span> <span class="title">HandlerInterceptor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    UserService userService;</span><br><span class="line"></span><br><span class="line">    Logger log = LoggerFactory.getLogger(AuthenticationInterceptor<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">//ä»httpè¯·æ±‚å–å‡ºtoken</span></span><br><span class="line">        String token = request.getHeader(<span class="string">"token"</span>);</span><br><span class="line">        log.info(<span class="string">"è·å–åˆ°çš„tokenä¸ºï¼š&#123;&#125;"</span>, token);</span><br><span class="line">        <span class="comment">//å¦‚æœä¸æ˜¯æ˜ å°„åˆ°æ–¹æ³•ç›´æ¥é€šè¿‡</span></span><br><span class="line">        <span class="keyword">if</span> (!(handler <span class="keyword">instanceof</span> HandlerMethod)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        HandlerMethod handlerMethod = (HandlerMethod) handler;</span><br><span class="line">        Method method = handlerMethod.getMethod();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//æ˜¯å¦æœ‰passtokenæ³¨é‡Šï¼Œæœ‰åˆ™è·³è¿‡è®¤è¯</span></span><br><span class="line">        <span class="keyword">if</span> (method.isAnnotationPresent(PassToken<span class="class">.<span class="keyword">class</span>)) </span>&#123;</span><br><span class="line">            PassToken passToken = method.getAnnotation(PassToken<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">            <span class="keyword">if</span> (passToken.required()) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//æœ‰æ²¡æœ‰éœ€è¦ç”¨æˆ·æƒé™çš„æ³¨è§£</span></span><br><span class="line">        <span class="keyword">if</span> (method.isAnnotationPresent(UserLoginToken<span class="class">.<span class="keyword">class</span>)) </span>&#123;</span><br><span class="line">            UserLoginToken userLoginToken = method.getAnnotation(UserLoginToken<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">            <span class="keyword">if</span> (userLoginToken.required()) &#123;</span><br><span class="line">                <span class="comment">//æ‰§è¡Œè®¤è¯</span></span><br><span class="line">                <span class="keyword">if</span> (token == <span class="keyword">null</span>) &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"æ— tokenï¼Œè¯·é‡æ–°ç™»å½•"</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">//è·å–tokenä¸­çš„user id</span></span><br><span class="line">                String userId;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    userId = JWT.decode(token).getAudience().get(<span class="number">0</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (JWTDecodeException e) &#123;</span><br><span class="line">                    log.info(<span class="string">"Tokenéæ³•"</span>);</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"401,Tokenéæ³•"</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                User user = userService.finduserbyId(userId);</span><br><span class="line">                <span class="keyword">if</span> (user == <span class="keyword">null</span>) &#123;</span><br><span class="line">                    log.info(<span class="string">"ç”¨æˆ·ä¸å­˜åœ¨ï¼Œè¯·é‡æ–°ç™»å½•!"</span>);</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"ç”¨æˆ·ä¸å­˜åœ¨ï¼Œè¯·é‡æ–°ç™»å½•!"</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">//éªŒè¯token</span></span><br><span class="line">                JWTVerifier jwtVerifier = JWT.require(Algorithm.HMAC256(user.getPassword())).build();</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    jwtVerifier.verify(token);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (JWTVerificationException e) &#123;</span><br><span class="line">                    log.info(<span class="string">"401,Tokenéæ³•"</span>);</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"401,Tokenéæ³•"</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">postHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterCompletion</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="6-6-controllerå±‚åŠ å…¥ç™»å½•æ“ä½œæ³¨è§£"><a href="#6-6-controllerå±‚åŠ å…¥ç™»å½•æ“ä½œæ³¨è§£" class="headerlink" title="6.6 controllerå±‚åŠ å…¥ç™»å½•æ“ä½œæ³¨è§£"></a>6.6 controllerå±‚åŠ å…¥ç™»å½•æ“ä½œæ³¨è§£</h6><p>â€‹        ä¸åŠ æ³¨è§£çš„è¯é»˜è®¤ä¸éªŒè¯ï¼Œç™»å½•æ¥å£ä¸€èˆ¬æ˜¯ä¸éªŒè¯çš„ã€‚åœ¨getMessage()ä¸Šäº†ç™»å½•æ³¨è§£ï¼Œè¯´æ˜è¯¥æ¥å£å¿…é¡»ç™»å½•è·å–tokenåï¼Œåœ¨è¯·æ±‚å¤´ä¸­åŠ ä¸Štokenå¹¶é€šè¿‡éªŒè¯æ‰å¯ä»¥è®¿é—®</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    Logger logger = LoggerFactory.getLogger(UserController<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    UserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    TokenService tokenService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"/wlecome"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">welcome</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"welcome TokenController"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(value = <span class="string">"/login"</span>, method = RequestMethod.GET)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">login</span><span class="params">(User user, HttpServletResponse response)</span> </span>&#123;</span><br><span class="line">        JSONObject jsonObject = <span class="keyword">new</span> JSONObject();</span><br><span class="line">        logger.info(<span class="string">"ç”¨æˆ·åusernameä¸º:"</span> + user.getUsername() + <span class="string">"å¯†ç passwordä¸º:"</span> + user.getPassword());</span><br><span class="line"></span><br><span class="line">        User userSearch = userService.getUser(user.getUsername(), user.getPassword());</span><br><span class="line">        <span class="keyword">if</span> (userSearch != <span class="keyword">null</span>) &#123;</span><br><span class="line">            String token = tokenService.getToken(userSearch);</span><br><span class="line">            jsonObject.put(<span class="string">"message"</span>, <span class="string">"ç”¨æˆ·ç™»å½•æˆåŠŸ!"</span>);</span><br><span class="line">            jsonObject.put(<span class="string">"token"</span>, token);</span><br><span class="line"></span><br><span class="line">            Cookie cookie = <span class="keyword">new</span> Cookie(<span class="string">"token"</span>, token);</span><br><span class="line">            cookie.setPath(<span class="string">"/"</span>);</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            jsonObject.put(<span class="string">"message"</span>, <span class="string">"ç™»é™†å¤±è´¥, å½“å‰ç”¨æˆ·ä¸å­˜åœ¨ï¼Œè¯·é‡æ–°è¾“å…¥ï¼"</span>);</span><br><span class="line">            <span class="keyword">return</span> ResponseTemplate.builder().code(<span class="number">500</span>).message(<span class="string">"è´¦å·æˆ–å¯†ç é”™è¯¯ï¼"</span>).data(jsonObject).build();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ResponseTemplate.builder().code(<span class="number">200</span>).message(<span class="string">"ç”¨æˆ·ç™»å½•æˆåŠŸ"</span>).data(jsonObject).build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@UserLoginToken</span></span><br><span class="line">    <span class="meta">@RequestMapping</span>(value = <span class="string">"getMessage"</span>, method = RequestMethod.GET)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">getMessage</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        logger.info(<span class="string">"**************æµ‹è¯•start**************"</span>);</span><br><span class="line">        <span class="keyword">return</span> ResponseTemplate.builder().code(<span class="number">200</span>).message(<span class="string">"è®¿é—®æˆåŠŸ"</span>).data(<span class="string">"æºå¸¦Tokenï¼ŒæˆåŠŸè®¿é—®"</span>).build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="6-7-serviceå±‚"><a href="#6-7-serviceå±‚" class="headerlink" title="6.7 serviceå±‚"></a>6.7 serviceå±‚</h6><p><strong>TokenService</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span>(<span class="string">"TokenService"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TokenService</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getToken</span><span class="params">(User user)</span> </span>&#123;</span><br><span class="line">        Date start = <span class="keyword">new</span> Date();</span><br><span class="line">        <span class="keyword">long</span> currentTime = System.currentTimeMillis() + <span class="number">60</span> * <span class="number">60</span> * <span class="number">1000</span>;<span class="comment">//Tokenä¸€å°æ—¶æœ‰æ•ˆ</span></span><br><span class="line">        Date end = <span class="keyword">new</span> Date(currentTime);</span><br><span class="line">        String token = <span class="string">""</span>;</span><br><span class="line"></span><br><span class="line">        token = JWT.create().withAudience(user.getId()).withIssuedAt(start).withExpiresAt(end)</span><br><span class="line">                .sign(Algorithm.HMAC256(user.getPassword()));</span><br><span class="line">        <span class="keyword">return</span> token;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>â€‹    æ–¹æ³•getToken(User user)ç”ŸæˆTokenï¼ŒAlgorithm.HMAC256(): ä½¿ç”¨HS256ç”Ÿæˆtoken,å¯†é’¥åˆ™æ˜¯ç”¨æˆ·çš„å¯†ç ï¼Œå”¯ä¸€å¯†é’¥çš„è¯å¯ä»¥ä¿å­˜åœ¨æœåŠ¡ç«¯ã€‚withAudience()å­˜å…¥éœ€è¦ä¿å­˜åœ¨tokençš„ä¿¡æ¯ï¼Œè¿™é‡ŒæŠŠç”¨æˆ·IDå­˜å…¥tokenä¸­ã€‚</p>
<p><strong>UserService</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span>(<span class="string">"UserService"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserService</span> </span>&#123;    </span><br><span class="line">    <span class="meta">@Autowired</span>    UserMapper userMapper;    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">getUser</span><span class="params">(String username, String password)</span> </span>&#123;        </span><br><span class="line">        <span class="keyword">return</span> userMapper.findByUserNameAndPasswd(username,password);    &#125;    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">finduserbyId</span><span class="params">(String userId)</span> </span>&#123;        </span><br><span class="line">        System.out.println(userId + <span class="string">"***************************"</span>);        </span><br><span class="line">        <span class="keyword">return</span> userMapper.findUserById(userId);    </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸¤ä¸ªæŸ¥æ‰¾Useræ–¹æ³•ï¼Œæ ¹æ®usernameå’Œpasswordï¼Œæˆ–idã€‚</p>
<p>@Serviceæ³¨è§£ï¼Œå°†è‡ªåŠ¨å°†è¯¥ç±»æ³¨å†Œåˆ°Springå®¹å™¨ä¸­ã€‚</p>
<h6 id="6-8-Daoå±‚"><a href="#6-8-Daoå±‚" class="headerlink" title="6.8 Daoå±‚"></a>6.8 Daoå±‚</h6><p><strong>UserMapper</strong>  Interface</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="meta">@C</span></span><br><span class="line">omponent</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserMapper</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function">User <span class="title">findByUserNameAndPasswd</span><span class="params">(String username, String userpasswd)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Select</span>(<span class="string">"select * from user where id=#&#123;id&#125;"</span>)</span><br><span class="line">    <span class="function">User <span class="title">findUserById</span><span class="params">(@Param(<span class="string">"id"</span>)</span> String id)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>@Componentæ³¨è§£ï¼Œå°†è¯¥æ¥å£æ³¨å†Œæˆå•ä¾‹beanç»„ä»¶åˆ°Springå®¹å™¨ä¸­ã€‚</p>
<p><strong>UserMapper.xml</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version='1.0' encoding='UTF-8' ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span> <span class="meta-keyword">PUBLIC</span> <span class="meta-string">"-//mybatis.org//DTD Mapper 3.0//EN"</span> <span class="meta-string">"http://mybatis.org/dtd/mybatis-3-mapper.dtd"</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"com.wu.springBootToken.mapper.UserMapper"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findByUserNameAndPasswd"</span> <span class="attr">resultType</span>=<span class="string">"com.wu.springBootToken.entity.User"</span>&gt;</span></span><br><span class="line">        select * from user</span><br><span class="line">        where username=#&#123;username&#125; and password=#&#123;userpasswd&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="7-æµ‹è¯•"><a href="#7-æµ‹è¯•" class="headerlink" title="7. æµ‹è¯•"></a>7. æµ‹è¯•</h5><h6 id="7-1-åœ¨æ²¡tokençš„æƒ…å†µä¸‹è®¿é—®-getMessageæ¥å£"><a href="#7-1-åœ¨æ²¡tokençš„æƒ…å†µä¸‹è®¿é—®-getMessageæ¥å£" class="headerlink" title="7.1 åœ¨æ²¡tokençš„æƒ…å†µä¸‹è®¿é—®/getMessageæ¥å£"></a>7.1 åœ¨æ²¡tokençš„æƒ…å†µä¸‹è®¿é—®/getMessageæ¥å£</h6><p><img src="/2019/10/13/SpringBoot-Token/getMessageNoToken.PNG" alt></p>
<h6 id="7-2-ç”¨æˆ·åå’Œå¯†ç ç™»å½•"><a href="#7-2-ç”¨æˆ·åå’Œå¯†ç ç™»å½•" class="headerlink" title="7.2 ç”¨æˆ·åå’Œå¯†ç ç™»å½•"></a>7.2 ç”¨æˆ·åå’Œå¯†ç ç™»å½•</h6><p><img src="/2019/10/13/SpringBoot-Token/login.PNG" alt></p>
<h6 id="7-3-è¯·æ±‚å¤´æºå¸¦tokençš„æƒ…å†µä¸‹è®¿é—®-getMessageæ¥å£"><a href="#7-3-è¯·æ±‚å¤´æºå¸¦tokençš„æƒ…å†µä¸‹è®¿é—®-getMessageæ¥å£" class="headerlink" title="7.3 è¯·æ±‚å¤´æºå¸¦tokençš„æƒ…å†µä¸‹è®¿é—®/getMessageæ¥å£"></a>7.3 è¯·æ±‚å¤´æºå¸¦tokençš„æƒ…å†µä¸‹è®¿é—®/getMessageæ¥å£</h6><p><img src="/2019/10/13/SpringBoot-Token/getMessageWithToken.PNG" alt></p>
<h5 id="8-ç›¸å…³è¿æ¥"><a href="#8-ç›¸å…³è¿æ¥" class="headerlink" title="8.ç›¸å…³è¿æ¥"></a>8.ç›¸å…³è¿æ¥</h5><p><a href="https://github.com/AndersonBlog/springBootToken.git" target="_blank" rel="noopener">é¡¹ç›®é“¾æ¥</a></p>
<p>å‚è€ƒèµ„æ–™ï¼š</p>
<p><a href="https://blog.csdn.net/FindHuni/article/details/94451136" target="_blank" rel="noopener">https://blog.csdn.net/FindHuni/article/details/94451136</a>       </p>
<p><a href="https://www.cnblogs.com/ChromeT/p/10932202.html" target="_blank" rel="noopener">https://www.cnblogs.com/ChromeT/p/10932202.html</a></p>
<p><a href="https://www.jianshu.com/p/e88d3f8151db" target="_blank" rel="noopener">https://www.jianshu.com/p/e88d3f8151db</a></p>
<p>â€‹        </p>

    </div>

    
    
    
	<div>
		
		 <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<div>
    
        <div style="text-align:center;color: #ccc;font-size:14px;">-------------æœ¬æ–‡ç»“æŸ<i class="fa fa-paw"></i>æ„Ÿè°¢æ‚¨çš„é˜…è¯»-------------</div>
		<div style="text-align:center;color: #ccc;font-size:14px;">
			<span>è®¿é—®æ€»é‡<span id="busuanzi_value_site_pv"></span>æ¬¡</span>
			<span>|</span>
			<span>æ€»è®¿å®¢<span id="busuanzi_value_site_uv"></span>äºº</span>
		</div>
      
</div>

		
	</div>
        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>æœ¬æ–‡ä½œè€…ï¼š </strong>Anderson Wu
  </li>
  <li class="post-copyright-link">
    <strong>æœ¬æ–‡é“¾æ¥ï¼š</strong>
    <a href="http://yoursite.com/2019/10/13/SpringBoot-Token/" title="SpringBootå®ç°åŸºäºTokençš„ç”¨æˆ·èº«ä»½éªŒè¯">http://yoursite.com/2019/10/13/SpringBoot-Token/</a>
  </li>
  <li class="post-copyright-license">
    <strong>ç‰ˆæƒå£°æ˜ï¼š </strong>æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/publicdomain/zero/1.0/" rel="noopener" target="_blank"><i class="fa fa-fw fa-creative-commons"></i>ZERO</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼
  </li>
</ul>
</div>


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Token-JWT-SpringBoot/" rel="tag"># Token JWT SpringBoot</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2019/09/27/%E6%B5%85%E6%9E%90cookie-session-token/" rel="prev" title="æµ…æcookieï¼Œsessionå’Œtoken">
      <i class="fa fa-chevron-left"></i> æµ…æcookieï¼Œsessionå’Œtoken
    </a></div>
      <div class="post-nav-item">
    <a href="/2019/10/27/Vue%E4%B8%ADslot-scope%E7%9A%84%E7%90%86%E8%A7%A3/" rel="next" title="Vueä¸­slot-scopeç†è§£">
      Vueä¸­slot-scopeç†è§£ <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  

  </div>


          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-æœ¬æ–‡æ¶‰åŠåˆ°çš„çŸ¥è¯†ï¼š"><span class="nav-text">1.æœ¬æ–‡æ¶‰åŠåˆ°çš„çŸ¥è¯†ï¼š</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-æ— çŠ¶æ€HTTPåè®®"><span class="nav-text">2.æ— çŠ¶æ€HTTPåè®®</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-Tokenï¼Ÿä¸ºä»€ä¹ˆéœ€è¦Tokenï¼Ÿ"><span class="nav-text">3.Tokenï¼Ÿä¸ºä»€ä¹ˆéœ€è¦Tokenï¼Ÿ</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#4-JWT"><span class="nav-text">4. JWT</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-é¡¹ç›®"><span class="nav-text">5.é¡¹ç›®</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#é¡¹ç›®ç»“æ„"><span class="nav-text">é¡¹ç›®ç»“æ„</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#é¡¹ç›®ä¾èµ–ï¼š"><span class="nav-text">é¡¹ç›®ä¾èµ–ï¼š</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#6-å®ç°æ­¥éª¤"><span class="nav-text">6.å®ç°æ­¥éª¤</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#6-1-è‡ªå®šä¹‰ä¸¤ä¸ªæ³¨è§£"><span class="nav-text">6.1 è‡ªå®šä¹‰ä¸¤ä¸ªæ³¨è§£</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#6-2-å®ä½“ç±»"><span class="nav-text">6.2 å®ä½“ç±»</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#6-3-è¿”å›ä½“"><span class="nav-text">6.3 è¿”å›ä½“</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#6-4åˆ›å»ºä¸€ä¸ªæ‹¦æˆªå™¨é…ç½®ï¼Œç”¨äºæ‹¦æˆªå‰ç«¯è¯·æ±‚ï¼Œå®ç°-WebMvcConfigurer-æ¥å£"><span class="nav-text">6.4åˆ›å»ºä¸€ä¸ªæ‹¦æˆªå™¨é…ç½®ï¼Œç”¨äºæ‹¦æˆªå‰ç«¯è¯·æ±‚ï¼Œå®ç° WebMvcConfigurer æ¥å£</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#6-5-åˆ›å»ºä¸€ä¸ªæ‹¦æˆªå™¨ï¼Œç»§æ‰¿HandlerInterceptionæ¥å£ï¼Œå®ç°æ‹¦æˆªè¿˜æ˜¯æ”¾é€šçš„é€»è¾‘ï¼Œæ‹¦æˆªåéœ€è¦è·å–tokenå¹¶æ ¡éªŒ"><span class="nav-text">6.5 åˆ›å»ºä¸€ä¸ªæ‹¦æˆªå™¨ï¼Œç»§æ‰¿HandlerInterceptionæ¥å£ï¼Œå®ç°æ‹¦æˆªè¿˜æ˜¯æ”¾é€šçš„é€»è¾‘ï¼Œæ‹¦æˆªåéœ€è¦è·å–tokenå¹¶æ ¡éªŒ</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#6-6-controllerå±‚åŠ å…¥ç™»å½•æ“ä½œæ³¨è§£"><span class="nav-text">6.6 controllerå±‚åŠ å…¥ç™»å½•æ“ä½œæ³¨è§£</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#6-7-serviceå±‚"><span class="nav-text">6.7 serviceå±‚</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#6-8-Daoå±‚"><span class="nav-text">6.8 Daoå±‚</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#7-æµ‹è¯•"><span class="nav-text">7. æµ‹è¯•</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#7-1-åœ¨æ²¡tokençš„æƒ…å†µä¸‹è®¿é—®-getMessageæ¥å£"><span class="nav-text">7.1 åœ¨æ²¡tokençš„æƒ…å†µä¸‹è®¿é—®&#x2F;getMessageæ¥å£</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#7-2-ç”¨æˆ·åå’Œå¯†ç ç™»å½•"><span class="nav-text">7.2 ç”¨æˆ·åå’Œå¯†ç ç™»å½•</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#7-3-è¯·æ±‚å¤´æºå¸¦tokençš„æƒ…å†µä¸‹è®¿é—®-getMessageæ¥å£"><span class="nav-text">7.3 è¯·æ±‚å¤´æºå¸¦tokençš„æƒ…å†µä¸‹è®¿é—®&#x2F;getMessageæ¥å£</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#8-ç›¸å…³è¿æ¥"><span class="nav-text">8.ç›¸å…³è¿æ¥</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Anderson Wu"
      src="/images/self.png">
  <p class="site-author-name" itemprop="name">Anderson Wu</p>
  <div class="site-description" itemprop="description">Love is love</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">23</span>
          <span class="site-state-item-name">æ—¥å¿—</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">åˆ†ç±»</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">16</span>
        <span class="site-state-item-name">æ ‡ç­¾</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/AndersonBlog" title="GitHub â†’ https:&#x2F;&#x2F;github.com&#x2F;AndersonBlog" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:anderson992@163.com" title="E-Mail â†’ mailto:anderson992@163.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://fontawesome.dashgame.com/#new" title="Icon â†’ https:&#x2F;&#x2F;fontawesome.dashgame.com&#x2F;#new" rel="noopener" target="_blank"><i class="fa fa-fw fa-bar-chart"></i>Icon</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://andersonblog.github.io/" title="GitHubBlog â†’ https:&#x2F;&#x2F;andersonblog.github.io&#x2F;" rel="noopener" target="_blank"><i class="fa fa-fw fa-github-alt"></i>GitHubBlog</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://andersonblog.gitee.io/" title="GiteeBlog â†’ https:&#x2F;&#x2F;andersonblog.gitee.io&#x2F;" rel="noopener" target="_blank"><i class="fa fa-fw fa-git-square"></i>GiteeBlog</a>
      </span>
  </div>
  <div class="cc-license motion-element" itemprop="license">
    <a href="https://creativecommons.org/publicdomain/zero/1.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-zero.svg" alt="Creative Commons"></a>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Anderson</span>
<script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
</div>
  <div class="powered-by">ç”± <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> å¼ºåŠ›é©±åŠ¨
  </div>


        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="æ€»è®¿å®¢é‡">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="æ€»è®¿é—®é‡">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
