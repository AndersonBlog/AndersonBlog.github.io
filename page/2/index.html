<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/2.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/1.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"yoursite.com","root":"/","scheme":"Gemini","version":"7.7.2","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="Love is love">
<meta property="og:type" content="website">
<meta property="og:title" content="陪你度过漫长岁月">
<meta property="og:url" content="http://yoursite.com/page/2/index.html">
<meta property="og:site_name" content="陪你度过漫长岁月">
<meta property="og:description" content="Love is love">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Anderson Wu">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://yoursite.com/page/2/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>陪你度过漫长岁月</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">陪你度过漫长岁月</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">To be yourself</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index">
            

  <div class="posts-expand">
        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/09/26/%E5%8D%9A%E5%AE%A2%E7%BC%96%E5%86%99%E6%AD%A5%E9%AA%A4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/self.png">
      <meta itemprop="name" content="Anderson Wu">
      <meta itemprop="description" content="Love is love">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="陪你度过漫长岁月">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/09/26/%E5%8D%9A%E5%AE%A2%E7%BC%96%E5%86%99%E6%AD%A5%E9%AA%A4/" class="post-title-link" itemprop="url">博客更新</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2019-09-26 20:02:19 / 修改时间：22:06:48" itemprop="dateCreated datePublished" datetime="2019-09-26T20:02:19+08:00">2019-09-26</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h5 id="更换环境操作"><a href="#更换环境操作" class="headerlink" title="更换环境操作"></a>更换环境操作</h5><ul>
<li><p>git clone yourBlogAddresss.github.io.git 拷贝仓库；</p>
</li>
<li><p>在本地yourBlogAddresss.github.io.git文件夹下通过Git bash依次执行</p>
<ul>
<li>npm install </li>
<li>git add .</li>
<li>git commit -m ‘xxxx’</li>
<li>git push origin hexo</li>
<li>hexo  g -d</li>
</ul>
</li>
</ul>
<p>  参考：</p>
<p>  <a href="https://www.zhihu.com/question/21193762" target="_blank" rel="noopener">https://www.zhihu.com/question/21193762</a></p>
<p>  <a href="https://www.jianshu.com/p/0b1fccce74e0" target="_blank" rel="noopener">https://www.jianshu.com/p/0b1fccce74e0</a></p>

      
    </div>

    
    
    
	<div>
		
	</div>
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/09/22/vue%E5%85%A8%E5%B1%80%E5%92%8C%E5%B1%80%E9%83%A8%E7%BB%84%E4%BB%B6%E6%B3%A8%E5%86%8C/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/self.png">
      <meta itemprop="name" content="Anderson Wu">
      <meta itemprop="description" content="Love is love">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="陪你度过漫长岁月">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/09/22/vue%E5%85%A8%E5%B1%80%E5%92%8C%E5%B1%80%E9%83%A8%E7%BB%84%E4%BB%B6%E6%B3%A8%E5%86%8C/" class="post-title-link" itemprop="url">vue组件注册</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2019-09-22 10:02:19 / 修改时间：21:38:07" itemprop="dateCreated datePublished" datetime="2019-09-22T10:02:19+08:00">2019-09-22</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h5 id="1-组件"><a href="#1-组件" class="headerlink" title="1.组件"></a>1.组件</h5><p>​         Vue中的组件提供可复用的实例，组件是一个对象，包含data, computed, watch, methods, filters以及vue组件生命周期钩子等成员属性。</p>
<p>​         当前使用的Vue版本：3.11        </p>
<h5 id="2-组件注册"><a href="#2-组件注册" class="headerlink" title="2.组件注册"></a>2.组件注册</h5><p>定义一个组件：</p>
<p>MyComponent.vue</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span>CustomerComponent----vue--------CustomerComponent<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line">  components: &#123;&#125;,</span><br><span class="line">  data() &#123;&#125;,</span><br><span class="line">  methods: &#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h6 id="2-1-局部组件"><a href="#2-1-局部组件" class="headerlink" title="2.1 局部组件"></a>2.1 局部组件</h6><p>ParentComponent.vue</p>
<ul>
<li>方式一： 组件引入局部组件</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">MyComponent</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">import</span> MyComponent <span class="keyword">from</span> <span class="string">'./components/MyComponent.vue'</span>;</span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line">  components: &#123;MyComponent&#125;, </span><br><span class="line">  data() &#123;&#125;,</span><br><span class="line">  methods: &#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>方式二：组件注册局部组件:</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">child-component</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="actionscript"><span class="keyword">var</span> Child = &#123;</span></span><br><span class="line"><span class="handlebars"><span class="xml">  template: '<span class="tag">&lt;<span class="name">h1</span>&gt;</span>我是局部组件<span class="tag">&lt;/<span class="name">h1</span>&gt;</span>'</span></span></span><br><span class="line">&#125;</span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="actionscript">  components: &#123; <span class="string">"child-component"</span>:child&#125;, </span></span><br><span class="line">  data() &#123;&#125;,</span><br><span class="line">  methods: &#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>​            通过这种方式注册局部组件，报错：You are using the runtime-only build of Vue where the template compiler is not available. Either pre-compile the templates into render functions, or use the compiler-included build.</p>
<p>Vue项目运行环境配置有两种版本：Compiler和Runtime。两者的区别：</p>
<ul>
<li>当对template模板内容编译是需要对字符串进行模板渲染或者可以绑定的html对象作为模板进行渲染的方式，就需要使用Compiler版本。</li>
<li>如果使用vue-loader加载.vue文件时（组件文件），webpack在打包对模板进行了渲染，就需要Runtime版本。</li>
</ul>
<p><strong>解决方案：</strong></p>
<ul>
<li>可以通过在<strong>webpack.config.js</strong>文件中添加</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">resolve: &#123; alias: &#123; vue: 'vue/dist/vue.js' &#125; &#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>引用vue时，直接写成如下即可</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">'vue/dist/vue.js'</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>以上两种方法都是通过引入vue.esm.js文件作为vue对象，配置成 compiler运行模式。</p>
<p>​          其实，Vue 最早会打包生成三个文件，一个是 runtime only 的文件 vue.common.js，一个是 compiler only 的文件 compiler.js，一个是 runtime + compiler 的文件 vue.js。</p>
<p>​            而<strong>vue.js = vue.common.js + compiler.js</strong>，而如果要使用 <strong>template</strong> 这个属性的话就一定要用 <strong>compiler.js</strong>，那么，引入 <strong>vue.js</strong> 是最恰当的。</p>
<p>​            vue模块的package.json的main字段默认为runtime模式， 指向了”dist/vue.runtime.common.js”位置。因此在组件中注册局部组件，需要对template模板内容时，应该引入<strong>vue/dist/vue.js</strong></p>
<p><a href="https://jiongks.name/blog/code-review-for-vue-next/" target="_blank" rel="noopener">参考教程</a></p>
<p>注意：<strong>局部注册的组件在其子组件中不可用</strong> </p>
<h6 id="2-2全局组件"><a href="#2-2全局组件" class="headerlink" title="2.2全局组件"></a>2.2全局组件</h6><p>全局组件需要在项目的main.js中进行注册：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> CustPor <span class="keyword">from</span> <span class="string">'./components/MyComponent.vue'</span></span><br><span class="line"></span><br><span class="line">Vue.component(<span class="string">'GlobalComponents'</span>,CustPor)</span><br></pre></td></tr></table></figure>

<p>然后在任意其他组件都使用该全局组件，不需要在vue实例选项components上在次定义，也不需要再次导入文件路径：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">GlobalComponents</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>相关参考：</p>
<p><a href="https://segmentfault.com/a/1190000011465462" target="_blank" rel="noopener">https://segmentfault.com/a/1190000011465462</a></p>
<p><a href="https://www.php.cn/js-tutorial-403100.html" target="_blank" rel="noopener">https://www.php.cn/js-tutorial-403100.html</a></p>

      
    </div>

    
    
    
	<div>
		
	</div>
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/09/22/vue%E4%BD%BF%E7%94%A8prop%E6%95%B0%E6%8D%AE%E7%BB%91%E5%AE%9A%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/self.png">
      <meta itemprop="name" content="Anderson Wu">
      <meta itemprop="description" content="Love is love">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="陪你度过漫长岁月">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/09/22/vue%E4%BD%BF%E7%94%A8prop%E6%95%B0%E6%8D%AE%E7%BB%91%E5%AE%9A%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9/" class="post-title-link" itemprop="url">vue使用props数据绑定异常</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2019-09-22 10:02:19 / 修改时间：22:09:48" itemprop="dateCreated datePublished" datetime="2019-09-22T10:02:19+08:00">2019-09-22</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h5 id="1-业务场景"><a href="#1-业务场景" class="headerlink" title="1.业务场景"></a>1.业务场景</h5><p>通过点击信息框，计算点击的次数。（商品信息为一个组件）</p>
<p><img src="vue%E4%BD%BF%E7%94%A8prop%E6%95%B0%E6%8D%AE%E7%BB%91%E5%AE%9A%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9/1.png" alt=""></p>
<p>子组件GlobalComponents.vue:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;div v-on:click=<span class="string">'increaseClcikTime'</span>&gt;clickTimes:&#123;&#123;<span class="keyword">this</span>.clickTime&#125;&#125;&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  &lt;/</span>div&gt;</span><br><span class="line">&lt;<span class="regexp">/template&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">&lt;script&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default &#123;</span></span><br><span class="line"><span class="regexp">  name: "GlobalComponents",</span></span><br><span class="line"><span class="regexp">  props:&#123;</span></span><br><span class="line"><span class="regexp">    name: String,</span></span><br><span class="line"><span class="regexp">    clickTime: String    </span></span><br><span class="line"><span class="regexp">  &#125;,</span></span><br><span class="line"><span class="regexp">  components: &#123;</span></span><br><span class="line"><span class="regexp">  &#125;,</span></span><br><span class="line"><span class="regexp">  methods: &#123;</span></span><br><span class="line"><span class="regexp">    increaseClcikTime: function()&#123;</span></span><br><span class="line"><span class="regexp">      this.clickTime ++</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;;</span></span><br><span class="line"><span class="regexp">&lt;/</span>script&gt;</span><br></pre></td></tr></table></figure>

<p>父组件：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">GlobalComponents</span> <span class="attr">clickTime</span>=<span class="string">'10'</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>控制台报错：</p>
<blockquote>
<p>vue.js?ba4c:634 [Vue warn]: Avoid mutating a prop directly since the value will be overwritten whenever the parent component re-renders. Instead, use a data or computed property based on the prop’s value. Prop being mutated: “clickTime”</p>
</blockquote>
<h5 id="2-单向数据流"><a href="#2-单向数据流" class="headerlink" title="2.单向数据流"></a>2.单向数据流</h5><p>​          props 都使得其父子 组件之间形成了一个<strong>单向下行绑定</strong>：父级 prop 的更新会向下流动到子组件中，但是反过来则不行。这样会防止从子组件意外改变父级组件的状态，从而导致你的应用的数据流向难以理解。</p>
<p>​         每次父级组件发生更新时，子组件中所有的 prop 都将会刷新为最新的值。这意味着你<strong>不</strong>应该在一个子组件内部改变 prop。如果你这样做了，Vue 会在浏览器的控制台中发出警告。</p>
<h5 id="3-解决方案"><a href="#3-解决方案" class="headerlink" title="3.解决方案"></a>3.解决方案</h5><p>  在子组件中定义一个变量接收prop值</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;div v-on:click=<span class="string">'increaseClcikTime'</span>&gt;clickTimes:&#123;&#123;<span class="keyword">this</span>.time&#125;&#125;&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  &lt;/</span>div&gt;</span><br><span class="line">&lt;<span class="regexp">/template&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">&lt;script&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default &#123;</span></span><br><span class="line"><span class="regexp">  name: "GlobalComponents",</span></span><br><span class="line"><span class="regexp">  props:&#123;</span></span><br><span class="line"><span class="regexp">    name: String,</span></span><br><span class="line"><span class="regexp">    clickTime: String    </span></span><br><span class="line"><span class="regexp">  &#125;,</span></span><br><span class="line"><span class="regexp">  components: &#123;</span></span><br><span class="line"><span class="regexp">  &#125;,</span></span><br><span class="line"><span class="regexp">  data()&#123;</span></span><br><span class="line"><span class="regexp">    return &#123;</span></span><br><span class="line"><span class="regexp">      time: Number(this.clickTime)</span></span><br><span class="line"><span class="regexp">    &#125;;</span></span><br><span class="line"><span class="regexp">  &#125;,</span></span><br><span class="line"><span class="regexp">  methods: &#123;</span></span><br><span class="line"><span class="regexp">    increaseClcikTime: function()&#123;</span></span><br><span class="line"><span class="regexp">      this.time ++</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;;</span></span><br><span class="line"><span class="regexp">&lt;/</span>script&gt;</span><br></pre></td></tr></table></figure>



<p><a href="https://www.jianshu.com/p/54cfaa2f5d5b" target="_blank" rel="noopener">参考资料</a></p>

      
    </div>

    
    
    
	<div>
		
	</div>
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/09/15/vue%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8C%87%E4%BB%A4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/self.png">
      <meta itemprop="name" content="Anderson Wu">
      <meta itemprop="description" content="Love is love">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="陪你度过漫长岁月">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/09/15/vue%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8C%87%E4%BB%A4/" class="post-title-link" itemprop="url">vue自定义指令</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-09-15 20:02:19" itemprop="dateCreated datePublished" datetime="2019-09-15T20:02:19+08:00">2019-09-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-09-22 14:31:01" itemprop="dateModified" datetime="2019-09-22T14:31:01+08:00">2019-09-22</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h5 id="1-背景："><a href="#1-背景：" class="headerlink" title="1.背景："></a>1.背景：</h5><p>​         这周差不多一周没有正式写代码，成为一名“数据分析师”，回想起之前学习的前端框架vue，我好像对vue的自定义指定不熟悉，决定学习这一部分内容。</p>
<h5 id="2-常用指令"><a href="#2-常用指令" class="headerlink" title="2.常用指令"></a>2.常用指令</h5><p>​        vue有很多常用指令，比如v-on添加监听事件，v-bind做属性绑定，v-if进行控制切换一个元素是否显示，v-for指令可以绑定数组的数据来渲染一个项目列表。</p>
<h5 id="3-自定义指令"><a href="#3-自定义指令" class="headerlink" title="3.自定义指令"></a>3.自定义指令</h5><p>​        利用之前ThoughtWorks老师教的“需求驱动学习法”，首先确定一个小需求：给文字添加粉红色。当然，直接添加样式就可以实现该需求，但使用自定义指令同样可以。</p>
<p>自定义属性实现该需求步骤：</p>
<ul>
<li>使用Vue.directive 注册一个全局自定义指令</li>
<li>第一个参数就是 指令名称 pink</li>
<li>el 表示当前的html dom对象</li>
<li>在方法体内可以通过 innerHTML style.color 操控当前元素，添加样式。</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Vue.directive(<span class="string">'pink'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">el</span>) </span>&#123;</span><br><span class="line">	el.innerHTML = el.innerHTML + <span class="string">' ( x-pink ) '</span></span><br><span class="line">	el.style.color = <span class="string">'pink'</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>源代码为：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"http://how2j.cn/study/vue.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"div1"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-pink</span>&gt;</span> 好好学习，天天向上 <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="actionscript">Vue.directive(<span class="string">'pink'</span>, <span class="function"><span class="keyword">function</span> <span class="params">(el)</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">    el.innerHTML = el.innerHTML + <span class="string">' ( 使用自定义指令x-pink ) '</span></span></span><br><span class="line"><span class="actionscript">    el.style.color = <span class="string">'pink'</span></span></span><br><span class="line">    el.font-weight:bold</span><br><span class="line">&#125;)</span><br><span class="line"> </span><br><span class="line"><span class="actionscript"><span class="keyword">new</span> Vue(&#123;</span></span><br><span class="line"><span class="actionscript">  el: <span class="string">'#div1'</span></span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>效果：</p>
<p><img src="vue%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8C%87%E4%BB%A4/define1.PNG" alt=""></p>
<h5 id="4-带参数的自定义指令"><a href="#4-带参数的自定义指令" class="headerlink" title="4.带参数的自定义指令"></a>4.带参数的自定义指令</h5><p>​        自定义指令可以获取视图中的json对象的值。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Vue.directive(<span class="string">'xart'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">el,binding</span>) </span>&#123;</span><br><span class="line">	el.innerHTML = el.innerHTML + <span class="string">'( '</span> + binding.value.text + <span class="string">' )'</span></span><br><span class="line">	el.style.color = binding.value.color</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">v-xart</span>=<span class="string">"&#123;color:'red',text:'best learning video'&#125;"</span>&gt;</span> 好好学习，天天向上 <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>​        xart为自定义指令的名称，el为Dom对象，binding.value 指令中的json对象，可以通过 .color 或 .text 获取对应的值。</p>
<p>源代码：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"http://how2j.cn/study/vue.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"div1"</span>&gt;</span></span><br><span class="line">     </span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-xart</span>=<span class="string">"&#123;color:'red',text:'best learning video'&#125;"</span>&gt;</span> 好好学习，天天向上 <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">     </span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="actionscript">Vue.directive(<span class="string">'xart'</span>, <span class="function"><span class="keyword">function</span> <span class="params">(el,binding)</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">    el.innerHTML = el.innerHTML + <span class="string">'( '</span> + binding.value.text + <span class="string">' )'</span></span></span><br><span class="line">    el.style.color = binding.value.color</span><br><span class="line">&#125;)</span><br><span class="line"> </span><br><span class="line"><span class="actionscript"><span class="keyword">new</span> Vue(&#123;</span></span><br><span class="line"><span class="actionscript">  el: <span class="string">'#div1'</span></span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>效果：</p>
<p><img src="vue%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8C%87%E4%BB%A4/define2.PNG" alt=""></p>

      
    </div>

    
    
    
	<div>
		
	</div>
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/09/08/Toplink/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/self.png">
      <meta itemprop="name" content="Anderson Wu">
      <meta itemprop="description" content="Love is love">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="陪你度过漫长岁月">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/09/08/Toplink/" class="post-title-link" itemprop="url">TopLink和Hibernate区别</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-09-08 20:02:19" itemprop="dateCreated datePublished" datetime="2019-09-08T20:02:19+08:00">2019-09-08</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-09-09 08:28:00" itemprop="dateModified" datetime="2019-09-09T08:28:00+08:00">2019-09-09</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h5 id="1-背景："><a href="#1-背景：" class="headerlink" title="1.背景："></a>1.背景：</h5><p>​        近期开发的SI项目中，使用的是TopLink持久化框架，将对象关系映射到oracle表。但是当我们准备将数据结构复杂的表单提交到后台时，我们发现当类属性是一个接口类型，在类的构造函数中，用接口的实现类赋值给该属性，而实现类中包含了一个Object属性，用set方法赋值具体的数据类，TopLink总是无法映射该数据类到指定表中。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ShippingInstructionBase</span></span>&#123;</span><br><span class="line">   <span class="keyword">private</span> ValueHolderInterface route;</span><br><span class="line">    </span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="title">ShippingInstructionBase</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.route = <span class="keyword">new</span> ValueHolder();</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> ShippingInstructionRoute <span class="title">getRoute</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    	<span class="keyword">return</span> (ShippingInstructionRoute) <span class="keyword">this</span>.route.getValue();</span><br><span class="line">   &#125; </span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setRoute</span><span class="params">(ShippingInstructionRoute route)</span> </span>&#123;</span><br><span class="line">    	<span class="keyword">this</span>.route.setValue(route);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ValueHolderInterface</span> </span>&#123;</span><br><span class="line">    <span class="function">Object <span class="title">getValue</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setValue</span><span class="params">(Object var1)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ValueHolder</span> <span class="keyword">implements</span> <span class="title">ValueHolderInterface</span></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> Object value;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ValueHolder</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ValueHolder</span><span class="params">(Object var1)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.value = var1;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> Object <span class="title">getValue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setValue</span><span class="params">(Object var1)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.value = var1;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>​        问题：数据类ShippingInstructionRoute无法映射成表数据。</p>
<h5 id="2-关于Toplink"><a href="#2-关于Toplink" class="headerlink" title="2.关于Toplink"></a>2.关于Toplink</h5><p>​        TopLink是Oracle旗下优秀的对象关系映射持久层解决方案，TopLink性能优异，功能强大，并且提供了独特的查询过滤器机制，以及对关系的处理和查询。最大的关系数据库厂商Oracle将其收购，发展成强大的对象映射中间件，但是最初TopLink并未开源，而另外以一种开源的O/R Mapping框架凭借着强大的功能，Java反射API进行对象的映射，和方便的关系查询，成为主流的JPA实现方式。</p>
<h5 id="3-Hibernate-JPA和Toplink-JPA"><a href="#3-Hibernate-JPA和Toplink-JPA" class="headerlink" title="3.Hibernate JPA和Toplink JPA"></a>3.Hibernate JPA和Toplink JPA</h5><p>​         比较两者区别首先需要了解JPA：</p>
<p>​        JPA(Java Persistence API)是Sun的官方Java持久性规范。它为Java开发人员提供了一个对象/关系映射工具来管理Java应用程序中的关系数据。</p>
<p>​         JPA具有以下三种特点:</p>
<ul>
<li><p>ORM映射成元数据</p>
<p>JPA支持XML和JDK5.0注释两种元数据（描述对象和表之间的映射关系）形式，将实体类对象持久化到数据库表中。</p>
</li>
<li><p>Java持久化API</p>
<p>JPA实现了对实体对象执行CRUD操作，开发者可以减少重复繁琐的JDBC和SQL。</p>
</li>
<li><p>查询语言</p>
<p>JPA支持通过面向对象的查询方式，查询数据，从而避免程序的SQL语句紧密耦合。</p>
</li>
</ul>
<p>关于Hibernate JPA和Toplink JPA的比较博客，能找的资料不多，可能是由于TopLink开源以来并没有广泛的推广，具体的比较如下：</p>
<p><img src="Toplink/compare1.PNG" alt=""></p>
<p><img src="Toplink/compare2PNG.PNG" alt=""></p>
<p><a href="https://www.jumpingbean.co.za/blogs/mark/hibernate-toplink-jpa-differences" target="_blank" rel="noopener">参考资料</a></p>
<h5 id="4-哪个更优秀？"><a href="#4-哪个更优秀？" class="headerlink" title="4.哪个更优秀？"></a>4.哪个更优秀？</h5><p>关于两者优劣，一直是众说纷纭，以下为一篇文章中的总结：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">TopLink is fast, nimbly maps complex relationships, and provides both EJB-like and nearly transparent Java models. But Oracle recently acquired TopLink, and Oracle is regrettably both a database vendor and an application server vendor. </span><br><span class="line">If you&#39;re a WebLogic customer or use a non-Oracle database, you&#39;re going to want to think long and hard before buying TopLink. It&#39;s still a great product for pure Oracle customers, but others simply must protect themselves against a potential change in direction of TopLink. Of course, you may choose to buy another proprietary OR mapper instead. </span><br><span class="line">The problem is that you&#39;d then be buying a proprietary product with less-than-compelling market share. You&#39;d have to pay more for training, experienced developers, and aftermarket tools. While TopLink has been king for a day, many customers will want to look away from the proprietary relational mappers</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Hibernate is the open-source darling</span><br><span class="line">	If you&#39;re looking for a good persistence framework and you like open-source software, you owe it to yourself to check out Hibernate. It&#39;s a lightweight persistence framework that&#39;s gathered quite a following. Like JDO, it works well with WebLogic, with or without EJB. It has several fundamental strengths:</span><br><span class="line">- Hibernate uses Java reflection instead of byte code enhancement to achieve transparency.</span><br><span class="line"></span><br><span class="line">- Hibernate performance is surprisingly good because it is such a lightweight framework.</span><br><span class="line"></span><br><span class="line">- The mapping flexibility is outstanding. It has good support for several relational </span><br><span class="line">databases, with complex relationships ranging from one-to-one to many-to-many.</span><br><span class="line">	Hibernate too has some disadvantages. It puts some limitations on your object model. (For example, one persistent class cannot map to more than one table.) The combination of a proprietary interface and smaller market share is also disconcerting, but Hibernate seems to have mitigated that risk by establishing good momentum. Other open-source persistence frameworks exist as well, but none with the momentum of Hibernate.</span><br></pre></td></tr></table></figure>

<p>​            总的来说，在TopLink开源前，Hibernate凭借其轻量级和映射的灵活性，而更加广泛使用，而TopLink开源后，和Oracle数据库相结合，性能更加优越。</p>
<p><strong>相关：</strong><a href="https://blog.csdn.net/zcy860511/article/details/38521595" target="_blank" rel="noopener">关于Hibernate和TopLink在插入和查询数据上的性能比较</a></p>

      
    </div>

    
    
    
	<div>
		
	</div>
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/09/01/event/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/self.png">
      <meta itemprop="name" content="Anderson Wu">
      <meta itemprop="description" content="Love is love">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="陪你度过漫长岁月">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/09/01/event/" class="post-title-link" itemprop="url">表单脚本</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2019-09-01 19:37:58 / 修改时间：22:28:22" itemprop="dateCreated datePublished" datetime="2019-09-01T19:37:58+08:00">2019-09-01</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h5 id="一、表单"><a href="#一、表单" class="headerlink" title="一、表单"></a>一、表单</h5><p>一个表单主要有三部分组成：</p>
<ul>
<li>表单标签：这里面包含了处理表单数据所用CGI程序的URL以及数据提交到服务器的方法。 </li>
<li>表单域：包含了文本框、密码框、隐藏域、多行文本框、复选框、单选框、下拉选择框和文件上传框等。 </li>
<li>表单按钮：包括提交按钮、复位按钮和一般按钮；用于将数据传送到服务器上的CGI脚本或者取消输入，还可以用表单按钮来控制其他定义了处理脚本的处理工作。</li>
</ul>
<p>​        HTML 表单用于搜集不同类型的用户输入。可以使用<code>&lt;form&gt;</code> 元素来定义。在 JavaScript 中，表单对应的是 HTMLFormElement 类型。 HTMLFormElement 继承了 HTMLElement ，因而与其他 HTML 元素具有相同的默认属性。此外，HTMLFormElement 还具有独特的属性和方法。</p>
<blockquote>
<ul>
<li>acceptCharset ：服务器能够处理的字符集；等价于 HTML 中的 accept-charset 特性。</li>
<li>action ：接受请求的 URL；等价于 HTML 中的 action 特性。</li>
<li>elements ：表单中所有控件的集合（ HTMLCollection ）。</li>
<li>enctype ：请求的编码类型；等价于 HTML 中的 enctype 特性。</li>
<li>length ：表单中控件的数量。</li>
<li>method ：要发送的 HTTP 请求类型，通常是 “get” 或 “post” ；等价于 HTML 的 method 特性。</li>
<li>name ：表单的名称；等价于 HTML 的 name 特性。</li>
<li>reset() ：将所有表单域重置为默认值。</li>
<li>submit() ：提交表单。</li>
<li>target ：用于发送请求和接收响应的窗口名称；等价于 HTML 的 target 特性。</li>
</ul>
</blockquote>
<p>​            获取得<code>&lt;form&gt;</code> 元素引用的方式最直接的方式就是将它看成与其他元素一样，并为其添加 id 特性，然后再像下面这样使用 getElementById() 方法找到它。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> form = <span class="built_in">document</span>.getElementById(<span class="string">"form1"</span>);</span><br></pre></td></tr></table></figure>

<p>​        其次，通过 document.forms 可以取得页面中所有的表单。在这个集合中，可以通过数值索引或name 值来取得特定的表单。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> firstForm = <span class="built_in">document</span>.forms[<span class="number">0</span>]; <span class="comment">//取得页面中的第一个表单</span></span><br><span class="line"><span class="keyword">var</span> myForm = <span class="built_in">document</span>.forms[<span class="string">"form2"</span>]; <span class="comment">//取得页面中名称为"form2"的表单</span></span><br></pre></td></tr></table></figure>

<h5 id="二、提交表单"><a href="#二、提交表单" class="headerlink" title="二、提交表单"></a>二、提交表单</h5><p>​        用户单击提交按钮或图像按钮时，就会提交表单。使用<code>&lt;input&gt;</code>或 <code>&lt;button&gt;</code> 都可以定义提交按钮，只要将其 type 特性的值设置为 “submit” 即可，而图像按钮则是通过将 <code>&lt;input&gt;</code> 的 type 特性值设置为”image” 来定义的。因此，只要我们单击以下代码生成的按钮，就可以提交表单。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 通用提交按钮 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"Submit Form"</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 自定义提交按钮 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"submit"</span>&gt;</span>Submit Form<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 图像按钮 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"image"</span> <span class="attr">src</span>=<span class="string">"graphic.gif"</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>​        只要表单中存在以上任何一种按钮，那么在相应的表单控件中拥有焦点的情况下，按回车就可提交表单，textArea例外。</p>
<p>​         以这种方式提交表单时，浏览器会在将请求发送给服务器之前触发 submit 事件。这样，我们就有机会验证表单数据，并据以决定是否允许表单提交。阻止这个事件的默认行为就可以取消表单提交。以下为阻止表单提交方式。</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> form = document.getElementById(<span class="string">"myForm"</span>);</span><br><span class="line">EventUtil.addHandler(form, <span class="string">"submit"</span>, function(<span class="keyword">event</span>)&#123;</span><br><span class="line">    <span class="comment">//取得事件对象</span></span><br><span class="line">    <span class="keyword">event</span> = EventUtil.getEvent(<span class="keyword">event</span>);</span><br><span class="line">    <span class="comment">//阻止默认事件</span></span><br><span class="line">    EventUtil.preventDefault(<span class="keyword">event</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>​        在 JavaScript 中，以编程方式调用 submit() 方法也可以提交表单。而且，这种方式无需表单包含提交按钮，任何时候都可以正常提交表单。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> form = <span class="built_in">document</span>.getElementById(<span class="string">"myForm"</span>);</span><br><span class="line"><span class="comment">// 提交表单</span></span><br><span class="line">form.submit();</span><br></pre></td></tr></table></figure>

<p>​         以调用 submit() 方法的形式提交表单时，不会触发 submit 事件，因此要记得在调用此方法之前先验证表单数据。</p>
<p>​        提交表单可能遇到最大的问题是：重复提交表单。当第一次提交表单时，如果反应时间很长，用户可能会变得不耐烦，而反复点击提交按钮，而重复提交表单。</p>
<p>​        解决重复提交表单的办法有两个：在第一次提交表单后就禁用提交按钮，或者利用 onsubmit 事件处理程序取消后续的表单提交操作。</p>
<h5 id="三、重置表单"><a href="#三、重置表单" class="headerlink" title="三、重置表单"></a>三、重置表单</h5><p>​        在用户单击重置按钮时，表单会被重置。使用 type 特性值为 “reset” 的 <input> 或 <button> 都可以创建重置按钮，实例如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 通用重置按钮 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"reset"</span> <span class="attr">value</span>=<span class="string">"Reset Form"</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 自定义重置按钮 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"reset"</span>&gt;</span>Reset Form<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>​        在重置表单时，所有表单字段都会恢复到页面刚加载完毕时的初始值。如果某个字段的初始值为空，就会恢复为空；而带有默认值的字段，也会恢复为默认值。</p>
<p>​         用户单击重置按钮重置表单时，会触发 reset 事件。</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> form = document.getElementById(<span class="string">"myForm"</span>);</span><br><span class="line">EventUtil.addHandler(form, <span class="string">"reset"</span>, function(<span class="keyword">event</span>)&#123;</span><br><span class="line">    <span class="comment">//取得事件对象</span></span><br><span class="line">    <span class="keyword">event</span> = EventUtil.getEvent(<span class="keyword">event</span>);</span><br><span class="line">    <span class="comment">//阻止表单重置</span></span><br><span class="line">    EventUtil.preventDefault(<span class="keyword">event</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>​           也可以通过 JavaScript 来重置表单，如下：</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> form = <span class="built_in">document</span>.getElementById(<span class="string">"myForm"</span>);</span><br><span class="line"><span class="comment">// 重置表单</span></span><br><span class="line">form.reset();</span><br></pre></td></tr></table></figure>

<p>​          调用 reset() 方法会像单击重置按钮一样触发 reset 事件。</p>
<p><strong>提示：</strong>事实上，重置表单的需求是很少见的。更常见的做法是提供一个取消按钮，让用户能够回到前一个页面，而不是不分青红皂白地重置表单中的所有值。</p>

      
    </div>

    
    
    
	<div>
		
	</div>
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/08/25/creat-object-JS/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/self.png">
      <meta itemprop="name" content="Anderson Wu">
      <meta itemprop="description" content="Love is love">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="陪你度过漫长岁月">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/08/25/creat-object-JS/" class="post-title-link" itemprop="url">JS中如何创建对象</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-08-25 23:02:09" itemprop="dateCreated datePublished" datetime="2019-08-25T23:02:09+08:00">2019-08-25</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-09-01 20:58:52" itemprop="dateModified" datetime="2019-09-01T20:58:52+08:00">2019-09-01</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h4 id="JS创建对象方式"><a href="#JS创建对象方式" class="headerlink" title="JS创建对象方式"></a>JS创建对象方式</h4><h5 id="一、工厂模式"><a href="#一、工厂模式" class="headerlink" title="一、工厂模式"></a>一、工厂模式</h5><p>JS中的工厂模式与Java中创建对象相似，都是通过抽象创建对象的具体过程，用函数来封装一个接口创建对象的细节，比如：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">creationPerson</span>(<span class="params">name,age,job</span>)</span>&#123;</span><br><span class="line">	<span class="keyword">var</span> o = <span class="keyword">new</span> <span class="built_in">Object</span>();</span><br><span class="line">	o.name = name;</span><br><span class="line">	o.age = age;</span><br><span class="line">	o.job = job;</span><br><span class="line">	o.sayName = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">		alert(<span class="keyword">this</span>.name);</span><br><span class="line">	&#125;;</span><br><span class="line">	<span class="keyword">return</span> o;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> person1 = createPerson(<span class="string">"Tip"</span>, <span class="number">29</span>, <span class="string">"programer"</span>);</span><br><span class="line"><span class="keyword">var</span> person2 = createPerson(<span class="string">"Wusi"</span>, <span class="number">32</span>, <span class="string">"Doctor"</span>);</span><br></pre></td></tr></table></figure>

<p><strong>优点：</strong></p>
<p>​          函数creatPerson()可以根据接受的参数来构建一个包含所有必要信息的Person对象，每次调用该函数都可以返回一个包含三个属性和一个方法的对象。</p>
<p><strong>缺点：</strong></p>
<p>​         没有解决对象识别的问题，无法确认得到的就是一个对象类型。</p>
<h5 id="二、构造函数模式"><a href="#二、构造函数模式" class="headerlink" title="二、构造函数模式"></a>二、构造函数模式</h5><p>​       使用构建函数创建对象，代码如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">name,age,family</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.name = name;</span><br><span class="line">    <span class="keyword">this</span>.age = age;</span><br><span class="line">    <span class="keyword">this</span>.family = family;</span><br><span class="line">    <span class="keyword">this</span>.say = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        alert(<span class="keyword">this</span>.name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> person1 = <span class="keyword">new</span> Person(<span class="string">"lisi"</span>,<span class="number">21</span>,[<span class="string">"lida"</span>,<span class="string">"lier"</span>,<span class="string">"wangwu"</span>]);</span><br><span class="line"><span class="keyword">var</span> person2 = <span class="keyword">new</span> Person(<span class="string">"lisi"</span>,<span class="number">21</span>,[<span class="string">"lida"</span>,<span class="string">"lier"</span>,<span class="string">"lisi"</span>]);</span><br><span class="line"><span class="built_in">console</span>.log(person1 <span class="keyword">instanceof</span> <span class="built_in">Object</span>); <span class="comment">//true</span></span><br><span class="line"><span class="built_in">console</span>.log(person1 <span class="keyword">instanceof</span> Person); <span class="comment">//true</span></span><br><span class="line"><span class="built_in">console</span>.log(person2 <span class="keyword">instanceof</span> <span class="built_in">Object</span>); <span class="comment">//true</span></span><br><span class="line"><span class="built_in">console</span>.log(person2 <span class="keyword">instanceof</span> Person); <span class="comment">//true</span></span><br></pre></td></tr></table></figure>

<p>​        比较构建函数和工厂模式，发现两者相似，但又不同，在构建函数模式中：</p>
<ul>
<li>没有显示地创建对象，只有当真正需要对象时，才创建。</li>
<li>直接将属性和方法赋给this对象。</li>
<li>不需要return语句</li>
</ul>
<p>构造函数和普通函数的区别：</p>
<ul>
<li>构造函数，本身就是一个函数</li>
<li>构造函数的函数名首字母大写</li>
<li>构造函数可以创建对象，而一般函数不能。</li>
</ul>
<p>在以上代码中，要创建person的实例，必须使用new操作符，这种方式调用构造函数实际上会经历4个步骤：<br>1、创建一个新对象<br>2、将构造函数的作用域赋给新对象 （this对象指向该新对象）<br>3、执行构造函数中的代码 （为该新对象添加属性）<br>4、返回新对象<br>创建自定义的构造函数可以将它的实例标识为一种特定的类型。<br><strong>构造函数的缺点：</strong><br>          每个方法都有在每个实例上重新创建一遍。person1和person2都有一个sayName()的方法，但两个方法不是同一个Function实例。不同实例上的同名函数是不相等的。<br>创建两个完成同样任务的Function实例没有必要，而且还有this对象在，不需要在执行代码前就把函数绑定在特定对象上，可以像下面这样。 </p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">name,age,family</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.name = name;</span><br><span class="line">    <span class="keyword">this</span>.age = age;</span><br><span class="line">    <span class="keyword">this</span>.family = family;</span><br><span class="line">    <span class="keyword">this</span>.say = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        alert(<span class="keyword">this</span>.name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sayName</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="keyword">this</span>);</span><br><span class="line">	alert(<span class="keyword">this</span>.name);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>​        把sayName属性设置成全局的sayName函数，这样，由于sayName包含的是一个指向函数的指针，因此person1和person2对象就共享了同一个函数。 </p>
<p>​        而这种情况又会引发另一种情况，当对象需要定义很多方法，那么就要定义很多全局函数，自定义的引用类型也没有封装可言了，原型模式可以解决这个问题。</p>
<h5 id="三、原型模式"><a href="#三、原型模式" class="headerlink" title="三、原型模式"></a>三、原型模式</h5><pre><code>在JS中，每一个函数都有一个prototype（原型）属性，该属性是一个指针，指向一个对象，在这对象中包含了可以由特定类型的所有实例共享的属性和方法。那么可以通过使用原型对象的方法让所有的对象实例共享所包含的属性和方法，而不用在构造方法中定义对象实例的信息，可以把这些信息直接添加到原型的对象中。</code></pre><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">&#125;</span><br><span class="line">　　Person.prototype.name = <span class="string">'Nicholas'</span>;</span><br><span class="line">　　Person.prototype.age = <span class="number">29</span>;</span><br><span class="line">　　Person.prototype.job = <span class="string">'Software Engineer'</span>;</span><br><span class="line">　　Person.prototype.sayName = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">　　　　alert(<span class="keyword">this</span>.name);</span><br><span class="line">　　&#125;</span><br><span class="line">　　<span class="keyword">var</span> person1 = <span class="keyword">new</span> Person();</span><br><span class="line">　　person1.sayName();<span class="comment">//"Nicholas"</span></span><br><span class="line"></span><br><span class="line">　　<span class="keyword">var</span> person2 = <span class="keyword">new</span> Person(); </span><br><span class="line">　　person2.sayName(); <span class="comment">//"Nicholas" </span></span><br><span class="line"></span><br><span class="line">　　alert(person1.sayName == person2.sayName); <span class="comment">//true</span></span><br></pre></td></tr></table></figure>

<p>​        在以上例子中，sayName( ) 方法和所有的属性直接添加到Person类的prototype属性中，构造函数是一个空的函数，可以通过调用构造函数来创建新的对象，在新的对象中具有相同的属性和方法，这与构造函数模式不同，新的对象中所有属性和方法都是所有实例共享的，即person1和person2访问的都是同一组属性和同一个sayName( ) 函数。</p>

      
    </div>

    
    
    
	<div>
		
	</div>
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/08/18/SpringBoot-Websocket/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/self.png">
      <meta itemprop="name" content="Anderson Wu">
      <meta itemprop="description" content="Love is love">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="陪你度过漫长岁月">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/08/18/SpringBoot-Websocket/" class="post-title-link" itemprop="url">SpringBoot利用websocket实现实时聊天</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-08-18 15:11:28" itemprop="dateCreated datePublished" datetime="2019-08-18T15:11:28+08:00">2019-08-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-08-27 12:07:16" itemprop="dateModified" datetime="2019-08-27T12:07:16+08:00">2019-08-27</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="一、什么是websocket-为什么需要它"><a href="#一、什么是websocket-为什么需要它" class="headerlink" title="一、什么是websocket?为什么需要它?"></a>一、什么是websocket?为什么需要它?</h3><p>​         WebSocket是一种计算机通信<strong>协议</strong>，可以通过单个TCP连接提供<strong>全双工</strong>(允许通信双方同时传输数据)通信通道。</p>
<p>通过HTTP也可以进行客户端和服务器之间的通信，为什么还需要websocket呢？</p>
<p>HTTP会具有以下特点或缺陷：</p>
<ul>
<li><strong>传统的HTTP请求是单向的 -</strong> 在传统的客户端服务器通信中，客户端始终发起请求。</li>
<li><strong>半双工 -</strong> 用户对资源的请求，然后服务器将其提供给客户端。响应仅在请求后发送。因此，一次只发生一个请求。</li>
<li><strong>多个TCP连接 -</strong> 对于每个请求，需要建立新的TCPsession，然后在收到响应后关闭。因此，如果不使用WebSockets，我们将有多个会话。</li>
<li><strong>重量级</strong> 正常HTTP请求和响应需要在客户端和服务器之间交换额外数据。</li>
</ul>
<p><img src="SpringBoot-Websocket/boot-32_4.jpg" alt="img"></p>
<p>​        </p>
<p>​         其实HTTP协议其实也能实现啊，比如用 Ajax 轮询或者Comet。轮询是指浏览器通过JavaScript启动一个定时器，然后以固定的间隔给服务器发请求，询问服务器有没有新消息。这个机制的缺点一是实时性不够，二是频繁的请求会给服务器带来极大的压力。</p>
<p>Comet本质上也是轮询，但是在没有消息的情况下，服务器先拖一段时间，等到有消息了再回复。这个机制暂时地解决了实时性问题，但是它带来了新的问题：以多线程模式运行的服务器会让大部分线程大部分时间都处于挂起状态，极大地浪费服务器资源。另外，一个HTTP连接在长时间没有数据传输的情况下，链路上的任何一个网关都可能关闭这个连接，而网关是我们不可控的，这就要求Comet连接必须定期发一些ping数据表示连接“正常工作”。</p>
<p>以上两种机制都治标不治本，所以，HTML5推出了WebSocket标准，让浏览器和服务器之间可以建立无限制的全双工通信，任何一方都可以主动发消息给对方，从而解决了实时通信的问题。</p>
<p><img src="SpringBoot-Websocket/ws.png" alt="img"></p>
<p>websocket具有以下特点：</p>
<ul>
<li><strong>WebSocket是双向的 -</strong>使用WebSocket客户端或服务器可以发起发送消息。</li>
<li><strong>WebSocket是全双工 -</strong>客户端和服务器通信彼此独立。</li>
<li><strong>单个TCP连接 -</strong>初始连接使用HTTP，然后此连接升级到基于套接字的连接。然后，该单个连接用于所有未来的通信</li>
<li><strong>轻量级</strong>与http相比，WebSocket消息数据交换要轻得多。</li>
</ul>
<p><img src="SpringBoot-Websocket/boot-32_5.jpg" alt="img"></p>
<p>WebSocket 使得客户端和服务器之间的数据交换变得更加简单，允许服务端主动向客户端推送数据。在 WebSocket API 中，浏览器和服务器只需要完成一次握手，两者之间就直接可以创建持久性的连接，并进行双向数据传输。</p>
<p>​       从通信效率来看， WebSocket 协议，能更好的节省服务器资源和带宽，并且能够更实时地进行通讯。</p>
<h3 id="二、websocket协议特点"><a href="#二、websocket协议特点" class="headerlink" title="二、websocket协议特点"></a>二、websocket协议特点</h3><p>websocket协议利用了HTTP协议来建立连接，由服务器发起连接，因此websocket请求是一个标准的HTTP请求，格式如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">GET ws://localhost:3000/ws/chat HTTP/1.1</span><br><span class="line">Host: localhost</span><br><span class="line">Upgrade: websocket</span><br><span class="line">Connection: Upgrade</span><br><span class="line">Origin: http://localhost:3000</span><br><span class="line">Sec-WebSocket-Key: client-random-string</span><br><span class="line">Sec-WebSocket-Version: 13</span><br></pre></td></tr></table></figure>

<p>该请求和普通的HTTP请求有几点不同：</p>
<ol>
<li>GET请求的地址不是类似<code>/path/</code>，而是以<code>ws://</code>开头的地址；</li>
<li>请求头<code>Upgrade: websocket</code>和<code>Connection: Upgrade</code>表示这个连接将要被转换为WebSocket连接；</li>
<li><code>Sec-WebSocket-Key</code>是用于标识这个连接，并非用于加密数据；</li>
<li><code>Sec-WebSocket-Version</code>指定了WebSocket的协议版本。</li>
</ol>
<p>随后，服务器如果接受该请求，就会返回如下响应：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 101 Switching Protocols</span><br><span class="line">Upgrade: websocket</span><br><span class="line">Connection: Upgrade</span><br><span class="line">Sec-WebSocket-Accept: server-random-string</span><br></pre></td></tr></table></figure>

<p>该响应代码<code>101</code>表示本次连接的HTTP协议即将被更改，更改后的协议就是<code>Upgrade: websocket</code>指定的WebSocket协议。</p>
<p>版本号和子协议规定了双方能理解的数据格式，以及是否支持压缩等等。如果仅使用WebSocket的API，就不需要关心这些，方法如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Socket = <span class="keyword">new</span> WebSocket(url, [protocol] );</span><br></pre></td></tr></table></figure>

<p>现在，一个WebSocket连接就建立成功，浏览器和服务器就可以随时主动发送消息给对方。消息有两种，一种是文本，一种是二进制数据。通常，可以发送JSON格式的文本，这样，在浏览器处理起来就十分容易。</p>
<p>为什么WebSocket连接可以实现全双工通信而HTTP连接不行呢？实际上HTTP协议是建立在TCP协议之上的，TCP协议本身就实现了全双工通信，但是HTTP协议的请求－应答机制限制了全双工通信。WebSocket连接建立以后，其实只是简单规定了一下：接下来，咱们通信就不使用HTTP协议了，直接互相发数据吧。</p>
<h3 id="三、Websocket的属性、事件和方法"><a href="#三、Websocket的属性、事件和方法" class="headerlink" title="三、Websocket的属性、事件和方法"></a>三、Websocket的属性、事件和方法</h3><ul>
<li>属性</li>
</ul>
<table>
<thead>
<tr>
<th align="left">属性</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Socket.readyState</td>
<td align="left">只读属性 <strong>readyState</strong> 表示连接状态，可以是以下值：<br>0 - 表示连接尚未建立。<br>1 - 表示连接已建立，可以进行通信。<br>2 - 表示连接正在进行关闭。<br>3 - 表示连接已经关闭或者连接不能打开。</td>
</tr>
<tr>
<td align="left">Socket.bufferedAmount</td>
<td align="left">只读属性 <strong>bufferedAmount</strong> 已被 send() 放入正在队列中等待传输，但是还没有发出的 UTF-8 文本字节数。</td>
</tr>
</tbody></table>
<ul>
<li>事件</li>
</ul>
<table>
<thead>
<tr>
<th align="left">事件</th>
<th align="left">事件处理程序</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">open</td>
<td align="left">Socket.onopen</td>
<td align="left">连接建立时触发</td>
</tr>
<tr>
<td align="left">message</td>
<td align="left">Socket.onmessage</td>
<td align="left">客户端接收服务端数据时触发</td>
</tr>
<tr>
<td align="left">error</td>
<td align="left">Socket.onerror</td>
<td align="left">通信发生错误时触发</td>
</tr>
<tr>
<td align="left">close</td>
<td align="left">Socket.onclose</td>
<td align="left">连接关闭时触发</td>
</tr>
</tbody></table>
<ul>
<li>方法</li>
</ul>
<table>
<thead>
<tr>
<th align="left">方法</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Socket.send()</td>
<td align="left">使用连接发送数据</td>
</tr>
<tr>
<td align="left">Socket.close()</td>
<td align="left">关闭连接</td>
</tr>
</tbody></table>
<h3 id="四、SpringBoot-Websocket实现聊天室"><a href="#四、SpringBoot-Websocket实现聊天室" class="headerlink" title="四、SpringBoot+ Websocket实现聊天室"></a>四、SpringBoot+ Websocket实现聊天室</h3><h4 id="1、搭建SpringBoot环境"><a href="#1、搭建SpringBoot环境" class="headerlink" title="1、搭建SpringBoot环境"></a>1、搭建SpringBoot环境</h4><p><strong>（1）新建项目，选择Spring Initializr，点击next：</strong></p>
<p><img src="SpringBoot-Websocket/Create2.png" alt=""></p>
<p><img src="SpringBoot-Websocket/create3.png" alt=""></p>
<p>上面的信息可自行修改，其他默认就行，之后next：</p>
<p><strong>（2）如图所示，添加web依赖，右上角Springboot版本号可自行选择。之后点击next：</strong></p>
<p><img src="SpringBoot-Websocket/create4.png" alt=""></p>
<p><strong>（4）点击Finish完成项目创建。进入到主界面后，maven会下载一些依赖包，可能会需要一段时间，整体目录如下：</strong></p>
<p><img src="SpringBoot-Websocket/create5.png" alt=""></p>
<p><img src="SpringBoot-Websocket/create6.png" alt=""></p>
<p><strong>（5）测试</strong></p>
<p><img src="SpringBoot-Websocket/create7.png" alt=""></p>
<p><img src="SpringBoot-Websocket/create8.png" alt=""></p>
<p><strong>快速搭建SpringBoot项目的方法：</strong></p>
<p>访问官网：<a href="https://start.spring.io/" target="_blank" rel="noopener">SpringBoot Initializr</a>，如下：</p>
<p><img src="SpringBoot-Websocket/create9.png" alt=""></p>
<p>解压后导入IDEA，即可。</p>
<h4 id="2、功能实现"><a href="#2、功能实现" class="headerlink" title="2、功能实现"></a>2、功能实现</h4><h5 id="（1）、引入依赖"><a href="#（1）、引入依赖" class="headerlink" title="（1）、引入依赖"></a>（1）、引入依赖</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--websocket依赖--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-websocket<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="（2）、编写一个WebSocketConfig配置类"><a href="#（2）、编写一个WebSocketConfig配置类" class="headerlink" title="（2）、编写一个WebSocketConfig配置类"></a>（2）、编写一个WebSocketConfig配置类</h5><p><img src="SpringBoot-Websocket/Code1.png" alt=""></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebSocketConfig</span> </span>&#123;</span><br><span class="line">   <span class="meta">@Bean</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> ServerEndpointExporter <span class="title">serverEndpointExporter</span><span class="params">()</span></span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> ServerEndpointExporter();</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>向容器注入对象ServerEndpointExporter，该bean会自动注册使用了<strong>@ServerEndpoint</strong>注解声明的Websocket endpoint</p>
<h5 id="（3）编写Websocket的实现类"><a href="#（3）编写Websocket的实现类" class="headerlink" title="（3）编写Websocket的实现类"></a>（3）编写Websocket的实现类</h5><p><img src="SpringBoot-Websocket/Code2.png" alt=""></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ServerEndpoint</span>(value = <span class="string">"/websocket"</span>)</span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyWebSocket</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//用来存放每个客户端对应的MyWebSocket对象。</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> CopyOnWriteArraySet&lt;MyWebSocket&gt; webSocketSet = <span class="keyword">new</span> CopyOnWriteArraySet&lt;MyWebSocket&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//与某个客户端的连接会话，需要通过它来给客户端发送数据</span></span><br><span class="line">    <span class="keyword">private</span> Session session;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@OnOpen</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onOpen</span><span class="params">(Session session)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.session = session;</span><br><span class="line">        webSocketSet.add(<span class="keyword">this</span>);</span><br><span class="line">        System.out.println(<span class="string">"有新连接加入！当前在线人数为"</span> + webSocketSet.size());</span><br><span class="line">        <span class="keyword">this</span>.session.getAsyncRemote().sendText(<span class="string">"恭喜您成功连接上WebSocket--&gt;当前在线人数为："</span> + webSocketSet.size());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *      * 连接关闭调用的方法</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@OnClose</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClose</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        webSocketSet.remove(<span class="keyword">this</span>);<span class="comment">//从set中删除</span></span><br><span class="line">        System.out.println(<span class="string">"有一连接关闭！当前在线人数为"</span> + webSocketSet.size());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *      * 收到客户端消息后调用的方法</span></span><br><span class="line"><span class="comment">     *      *</span></span><br><span class="line"><span class="comment">     *      * <span class="doctag">@param</span> message 客户端发送过来的消息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@OnMessage</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onMessage</span><span class="params">(String message, Session session)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"来自客户端的消息:"</span> + message);</span><br><span class="line">        <span class="comment">//群发消息</span></span><br><span class="line">        broadcast(message);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *  发生错误时调用</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@OnError</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onError</span><span class="params">(Session session, Throwable error)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"发生错误"</span>);</span><br><span class="line">        error.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *  群发自定义消息 </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">broadcast</span><span class="params">(String message)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (MyWebSocket item : webSocketSet) &#123;</span><br><span class="line">            <span class="comment">//this.session.getBasicRemote().sendText(message);</span></span><br><span class="line">            item.session.getAsyncRemote().sendText(message);<span class="comment">//异步发送消息.</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>​        webSocketSet是保存用户session的集合，当出现用户加入群聊时，把该用户的session添加到session集合中，但用户退出群聊时，删除对应的session。</p>
<p>​        其中，broadcast()方法，将所有用户session中的消息以广播的形式发送，发送的形式有：</p>
<ul>
<li><p>getBasicRemote()同步</p>
</li>
<li><p>getAsyncRemote()异步</p>
<p>那两种发送方式有什么区别呢？参考<a href="https://blogs.oracle.com/pavelbucek/is-websocket-session-really-thread-safe" target="_blank" rel="noopener">websocket的同步和异步发送区别</a></p>
</li>
</ul>
<p>大致可以总结为：</p>
<p>​        一般情况，推荐使用getAsyncRemote()。由于getBasicRemote()的同步特性，并且它支持部分消息的发送即sendText(xxx,boolean isLast)， isLast的值表示是否一次发送消息中的部分消息，对于如下情况:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">session.getBasicRemote().sendText(message, <span class="keyword">false</span>); </span><br><span class="line"></span><br><span class="line">session.getBasicRemote().sendBinary(data);</span><br><span class="line"></span><br><span class="line">session.getBasicRemote().sendText(message, <span class="keyword">true</span>);</span><br></pre></td></tr></table></figure>

<p>由于同步特性，第二行的消息必须等待第一行的发送完成才能进行，而第一行的剩余部分消息要等第二行发送完才能继续发送，所以在第二行会抛出IllegalStateException异常。如果要使用getBasicRemote()同步发送消息，则避免尽量一次发送全部消息，使用部分消息来发送。</p>
<h5 id="（4）编写页面webSocketTest-html-放到static目录下"><a href="#（4）编写页面webSocketTest-html-放到static目录下" class="headerlink" title="（4）编写页面webSocketTest.html(放到static目录下)"></a>（4）编写页面webSocketTest.html(放到static目录下)</h5><p><img src="SpringBoot-Websocket/Code3.png" alt=""></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">HTML</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>My WebSocket<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="css">        <span class="selector-id">#message</span> &#123;</span></span><br><span class="line">            margin-top: 40px;</span><br><span class="line">            border: 1px solid gray;</span><br><span class="line">            padding: 20px;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">"conectWebSocket()"</span>&gt;</span>连接WebSocket<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">"closeWebSocket()"</span>&gt;</span>断开连接<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">hr</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">消息：<span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">"text"</span> <span class="attr">type</span>=<span class="string">"text"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">"send()"</span>&gt;</span>发送消息<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"message"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span></span><br><span class="line"><span class="actionscript">    <span class="keyword">var</span> websocket = <span class="literal">null</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="actionscript">    <span class="function"><span class="keyword">function</span> <span class="title">conectWebSocket</span><span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">        <span class="comment">//判断当前浏览器是否支持WebSocket</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">if</span> (<span class="string">'WebSocket'</span> <span class="keyword">in</span> <span class="built_in">window</span>) &#123;</span></span><br><span class="line"><span class="actionscript">            websocket = <span class="keyword">new</span> WebSocket(<span class="string">"ws://localhost:8080/websocket"</span>);</span></span><br><span class="line"><span class="actionscript">        &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="actionscript">            alert(<span class="string">'Not support websocket'</span>)</span></span><br><span class="line">        &#125;</span><br><span class="line"><span class="actionscript">        <span class="comment">//连接发生错误的回调方法</span></span></span><br><span class="line"><span class="actionscript">        websocket.onerror = <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">            setMessageInnerHTML(<span class="string">"error"</span>);</span></span><br><span class="line">        &#125;;</span><br><span class="line"><span class="actionscript">        <span class="comment">//连接成功建立的回调方法</span></span></span><br><span class="line"><span class="actionscript">        websocket.onopen = <span class="function"><span class="keyword">function</span> <span class="params">(event)</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">            setMessageInnerHTML(<span class="string">"Loc MSG: 成功建立连接"</span>);</span></span><br><span class="line">        &#125;</span><br><span class="line"><span class="actionscript">        <span class="comment">//接收到消息的回调方法</span></span></span><br><span class="line"><span class="actionscript">        websocket.onmessage = <span class="function"><span class="keyword">function</span> <span class="params">(event)</span> </span>&#123;</span></span><br><span class="line">            setMessageInnerHTML(event.data);</span><br><span class="line">        &#125;</span><br><span class="line"><span class="actionscript">        <span class="comment">//连接关闭的回调方法</span></span></span><br><span class="line"><span class="actionscript">        websocket.onclose = <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">            setMessageInnerHTML(<span class="string">"Loc MSG:关闭连接"</span>);</span></span><br><span class="line">        &#125;</span><br><span class="line"><span class="actionscript">        <span class="comment">//监听窗口关闭事件，当窗口关闭时，主动去关闭websocket连接，防止连接还没断开就关闭窗口，server端会抛异常。</span></span></span><br><span class="line"><span class="javascript">        <span class="built_in">window</span>.onbeforeunload = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line">            websocket.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="actionscript">    <span class="comment">//将消息显示在网页上</span></span></span><br><span class="line"><span class="actionscript">    <span class="function"><span class="keyword">function</span> <span class="title">setMessageInnerHTML</span><span class="params">(innerHTML)</span> </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">document</span>.getElementById(<span class="string">'message'</span>).innerHTML += innerHTML + <span class="string">'&lt;br/&gt;'</span>;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="actionscript">    <span class="comment">//关闭连接</span></span></span><br><span class="line"><span class="actionscript">    <span class="function"><span class="keyword">function</span> <span class="title">closeWebSocket</span><span class="params">()</span> </span>&#123;</span></span><br><span class="line">        websocket.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="actionscript">    <span class="comment">//发送消息</span></span></span><br><span class="line"><span class="actionscript">    <span class="function"><span class="keyword">function</span> <span class="title">send</span><span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> message = <span class="built_in">document</span>.getElementById(<span class="string">'text'</span>).value;</span></span><br><span class="line">        websocket.send(message);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="（5）测试"><a href="#（5）测试" class="headerlink" title="（5）测试"></a>（5）测试</h5><p>访问url:  localhost:8080/webSocketTest.html，点击【连接WebSocket】，发送消息。</p>
<p><img src="SpringBoot-Websocket/Test1.png" alt=""></p>
<p><img src="SpringBoot-Websocket/Test2.png" alt=""></p>
<h5 id="（6）存在问题"><a href="#（6）存在问题" class="headerlink" title="（6）存在问题"></a>（6）存在问题</h5><p>当前消息无法显示是哪位用户发送的，可阅读性差，需要改进。</p>
<h4 id="3、改进"><a href="#3、改进" class="headerlink" title="3、改进"></a>3、改进</h4><p><strong>前端页面的改进</strong></p>
<h5 id="（1）连接时，输入用户昵称"><a href="#（1）连接时，输入用户昵称" class="headerlink" title="（1）连接时，输入用户昵称"></a>（1）连接时，输入用户昵称</h5><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">input type="text" id="nickname"/&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> ο<span class="attr">nclick</span>=<span class="string">"conectWebSocket()"</span>&gt;</span>连接WebSocket<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="（2）连接前的校验"><a href="#（2）连接前的校验" class="headerlink" title="（2）连接前的校验"></a>（2）连接前的校验</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> nickname = <span class="built_in">document</span>.getElementById(<span class="string">"nickname"</span>).value;</span><br><span class="line"><span class="keyword">if</span>(nickname===<span class="string">""</span>)&#123;</span><br><span class="line">    alert(<span class="string">"请输入昵称"</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="（3）显示昵称"><a href="#（3）显示昵称" class="headerlink" title="（3）显示昵称"></a>（3）显示昵称</h5><p>修改客户端的连接方式：</p>
<ul>
<li>Js代码，修改页面webSocketTest.html中连接服务器的URL</li>
</ul>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">websocket = <span class="keyword">new</span> WebSocket(<span class="string">"ws://localhost:8080/websocket/"</span>+nickname);</span><br></pre></td></tr></table></figure>

<ul>
<li>Java代码，在MyWebSocket类中，添加属性nickname，使得每个方法都可以获取该参数。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ServerEndpoint</span>(value = <span class="string">"/websocket/&#123;nickname&#125;"</span>)  </span><br><span class="line"><span class="meta">@Component</span>  </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyWebSocket</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure>

<p>添加属性：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> String nickname;</span><br></pre></td></tr></table></figure>

<p>修改建立连接和发送消息的方法参数：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@OnOpen</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onOpen</span><span class="params">(Session session,@PathParam(<span class="string">"nickname"</span>)</span> String nickname) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.session = session;</span><br><span class="line">    <span class="keyword">this</span>.nickname=nickname;</span><br><span class="line">    webSocketSet.add(<span class="keyword">this</span>);     <span class="comment">//加入set中</span></span><br><span class="line">    System.out.println(<span class="string">"有新连接加入:"</span>+nickname+<span class="string">",当前在线人数为"</span> + webSocketSet.size());</span><br><span class="line">    <span class="keyword">this</span>.session.getAsyncRemote().sendText(<span class="string">"恭喜您成功连接上WebSocket--&gt;当前在线人数为："</span>+webSocketSet.size());</span><br><span class="line"></span><br><span class="line"><span class="meta">@OnMessage</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onMessage</span><span class="params">(String message, Session session,@PathParam(<span class="string">"nickname"</span>)</span> String nickname) </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">"来自客户端的消息--&gt;"</span>+nickname+<span class="string">": "</span> + message);</span><br><span class="line">    <span class="comment">//群发消息</span></span><br><span class="line">    broadcast(nickname+<span class="string">": "</span>+message);</span><br></pre></td></tr></table></figure>

<h5 id="（4）测试"><a href="#（4）测试" class="headerlink" title="（4）测试"></a>（4）测试</h5><p>访问url:  localhost:8080/webSocketTest.html，点击【连接WebSocket】，发送消息。</p>
<p><img src="SpringBoot-Websocket/Test2-1.png" alt=""></p>
<p><img src="SpringBoot-Websocket/Test2-2.png" alt=""></p>
<h4 id="4、完成！"><a href="#4、完成！" class="headerlink" title="4、完成！"></a>4、完成！</h4><p><a href="https://github.com/AndersonBlog/SpringBootWebsocketDemo.git" target="_blank" rel="noopener">源码地址</a></p>
<h5 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h5><p><a href="https://www.runoob.com/html/html5-websocket.html" target="_blank" rel="noopener">https://www.runoob.com/html/html5-websocket.html</a></p>
<p><a href="https://www.javainuse.com/spring/boot-websocket" target="_blank" rel="noopener">https://www.javainuse.com/spring/boot-websocket</a></p>
<p><a href="https://www.liaoxuefeng.com/wiki/1022910821149312/1103303693824096" target="_blank" rel="noopener">https://www.liaoxuefeng.com/wiki/1022910821149312/1103303693824096</a></p>

      
    </div>

    
    
    
	<div>
		
	</div>
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/08/12/Targets/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/self.png">
      <meta itemprop="name" content="Anderson Wu">
      <meta itemprop="description" content="Love is love">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="陪你度过漫长岁月">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/08/12/Targets/" class="post-title-link" itemprop="url">Anderson未来一个半月的可量化目标</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-08-12 20:17:49" itemprop="dateCreated datePublished" datetime="2019-08-12T20:17:49+08:00">2019-08-12</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-08-27 12:07:48" itemprop="dateModified" datetime="2019-08-27T12:07:48+08:00">2019-08-27</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="未来一个半月的可量化目标"><a href="#未来一个半月的可量化目标" class="headerlink" title="未来一个半月的可量化目标"></a>未来一个半月的可量化目标</h3><h4 id="生命不息，学习不止"><a href="#生命不息，学习不止" class="headerlink" title="生命不息，学习不止"></a><strong>生命不息，学习不止</strong></h4><p>回顾过去一个月的学习，我基本了解自己前后端的技术栈的能力水平，java基础一般，SpringBoot框架有一定的应用能力，前端知识欠缺，沟通表达能力一般，团队协作能力一般，为了全面平衡可持续发展，我决定指定一个可量化的学习目标，对未来一个半月的学习内容进行规划安排，如下：</p>
<ol>
<li>学习《JavaScript高级程序设计》前50%的内容，并总结出三篇学习总结博客</li>
<li>学习Java整合WebSocket实现实时消息推送，总结出一篇博客</li>
<li>学习Springboot利用token进行身份认证，总结出一篇博客</li>
</ol>
<p>以上的学习计划，按优先级先后排序，还有学习组内各位大佬的博客，及时反思和回顾。</p>

      
    </div>

    
    
    
	<div>
		
	</div>
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/08/11/Hadoop/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/self.png">
      <meta itemprop="name" content="Anderson Wu">
      <meta itemprop="description" content="Love is love">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="陪你度过漫长岁月">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/08/11/Hadoop/" class="post-title-link" itemprop="url">搭建Hadoop完全分布式</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-08-11 23:32:20" itemprop="dateCreated datePublished" datetime="2019-08-11T23:32:20+08:00">2019-08-11</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-09-26 22:03:57" itemprop="dateModified" datetime="2019-09-26T22:03:57+08:00">2019-09-26</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="搭建hadoop完全分布式详细教程"><a href="#搭建hadoop完全分布式详细教程" class="headerlink" title="搭建hadoop完全分布式详细教程"></a>搭建hadoop完全分布式详细教程</h3><p>链接：<a href="https://www.cnblogs.com/frankdeng/p/9047698.html" target="_blank" rel="noopener">https://www.cnblogs.com/frankdeng/p/9047698.html</a></p>
<pre><code>https://blog.csdn.net/nbjjy/article/details/80339187</code></pre><h3 id="1-克隆虚拟机"><a href="#1-克隆虚拟机" class="headerlink" title="1.  克隆虚拟机"></a>1.  克隆虚拟机</h3><h3 id="2-修改4台克隆机的IP为固定IP、主机名和IP-主机名的映射"><a href="#2-修改4台克隆机的IP为固定IP、主机名和IP-主机名的映射" class="headerlink" title="2.  修改4台克隆机的IP为固定IP、主机名和IP-主机名的映射"></a>2.  修改4台克隆机的IP为固定IP、主机名和IP-主机名的映射</h3><table>
<thead>
<tr>
<th>ip</th>
<th>主机名</th>
</tr>
</thead>
<tbody><tr>
<td>192.168.183.31</td>
<td>CentOS01</td>
</tr>
<tr>
<td>192.168.183.32</td>
<td>CentOS02</td>
</tr>
<tr>
<td>192.168.183.33</td>
<td>CentOS03</td>
</tr>
<tr>
<td>192.168.183.34</td>
<td>CentOS04</td>
</tr>
<tr>
<td>192.168.183.35</td>
<td>CentOS05</td>
</tr>
</tbody></table>
<p>临时修改：</p>
<blockquote>
<p>hostname CentOS0X</p>
</blockquote>
<p>永久修改：</p>
<blockquote>
<p>vim /etc/sysconfig/network  </p>
<p>HOSTNAME=CentOS0X</p>
</blockquote>
<h3 id="3-检查虚拟机的防火墙状态"><a href="#3-检查虚拟机的防火墙状态" class="headerlink" title="3.  检查虚拟机的防火墙状态"></a>3.  检查虚拟机的防火墙状态</h3><blockquote>
<p>service iptables status</p>
</blockquote>
<h3 id="4-检查虚拟机是否开启SSH"><a href="#4-检查虚拟机是否开启SSH" class="headerlink" title="4.  检查虚拟机是否开启SSH"></a>4.  检查虚拟机是否开启SSH</h3><p>命令：ps -e|grep ssh </p>
<blockquote>
<p>root@ubuntu:/etc$ sudo ps -e | grep ssh</p>
<p>1529 ?        00:00:00 ssh-agent————对应客户端</p>
<p>3366 ?        00:00:00 sshd——对应服务器端</p>
</blockquote>
<ul>
<li>开启了SSH，就可以在NameNode远程登录克隆机，并把host文件发给克隆机</li>
</ul>
<h3 id="5-检查hadoop和JDk是否安装"><a href="#5-检查hadoop和JDk是否安装" class="headerlink" title="5.  检查hadoop和JDk是否安装"></a>5.  检查hadoop和JDk是否安装</h3><blockquote>
<p>hadoop version</p>
<p>java -version</p>
</blockquote>
<ul>
<li>如果发现命令执行不了，重新读入环境配置文件</li>
</ul>
<blockquote>
<p>source /etc/profile 保存并让配置立即生效</p>
</blockquote>
<h3 id="6-格式化文件系统"><a href="#6-格式化文件系统" class="headerlink" title="6.  格式化文件系统"></a>6.  格式化文件系统</h3><ul>
<li><p>因为克隆之前没格式化，所以这里要给<del>5台虚拟机格式化一下</del>只需给namenode节点格式化！！</p>
<p>由于配置了·hadoop的环境变量，可以在任何目录下执行：<br>hadoop namenode -format<br>若没有配置该环境变量，需要到 hadoop安装目录的bin目录下执行，其中./不能省略。<br> ./hadoop namenode -format</p>
<p>如果出现如下标识，代表格式化成功。。。<br>18/09/10 13:56:09 INFO common.Storage: Storage directory /tmp/hadoop-root/dfs/name has been successfully formatted.</p>
</li>
</ul>
<h3 id="7-远程复制hosts文件"><a href="#7-远程复制hosts文件" class="headerlink" title="7.  远程复制hosts文件"></a>7.  远程复制hosts文件</h3><blockquote>
<p>例：scp root@ubuntu02:/etc/hosts root@ubuntu03:/etc/</p>
<p>[root@CentOS01 Desktop]# scp /etc/hosts root@CentOS02:/etc/</p>
<p>源主机用户名@源主机名:目录下的文件  目的主机登陆的用户名@目的主机名:粘贴的目录    </p>
</blockquote>
<h3 id="8-SSH免密登录"><a href="#8-SSH免密登录" class="headerlink" title="8.  SSH免密登录"></a>8.  SSH免密登录</h3><ul>
<li>这里只需实现NameNode免密登录其他四个结点，所以把CentOS01的公钥发给其他的四台虚拟机</li>
</ul>
<p>在各个虚拟机中的任意目录下，执行：（我一直都是使用root身份，生成密钥）</p>
<blockquote>
<p>ssh-keygen -t rsa     //  -t 指定加密算法  -p指定密码  -f指定存放的目录</p>
</blockquote>
<p>然后一直回车，直到：</p>
<p><img src="Hadoop/1536298122980.png" alt=""></p>
<p>成功后，在/root/.ssh/下会生成：</p>
<blockquote>
<p>drwx—— 2 root root 4096 Sep  6 22:26 .<br>drwx—— 7 root root 4096 Sep  6 19:53 ..<br><strong><em>==-rw——- 1 root root 1675 Sep  6 22:26 id_rsa==</em></strong><br><strong><em>==-rw-r–r– 1 root root  395 Sep  6 22:26 id_rsa.pub==</em></strong><br>-rw-r–r– 1 root root  444 Sep  6 19:53 known_hosts</p>
</blockquote>
<p>在CentOS01中的/root/.ssh/下，执行：</p>
<blockquote>
<p>[root@CentOS01 ~]# scp /root/.ssh/id_rsa.pub root@CentOS02:/root/.ssh/id_rsa.pub.CentOS01</p>
<p>​                                      源文件       目标用户@目标主机:目标目录/目标文件的新命名（为了与其自身的公钥区）</p>
</blockquote>
<p>在ubuntu02中的/root/.ssh/目录下，把接收到的ubuntu01的公钥拼接到认证库中。</p>
<blockquote>
<p>root@CentOS02:~/.ssh# cat id_rsa.pub.CentOS01 &gt;&gt; authorized_keys</p>
</blockquote>
<p>回到ubunt01，ssh登录ubuntu02：</p>
<blockquote>
<p>ssh CentOS02</p>
</blockquote>
<p>成功！！！！</p>
<h3 id="9-安装zookeeper"><a href="#9-安装zookeeper" class="headerlink" title="9.  安装zookeeper"></a>9.  安装zookeeper</h3><p>教程：<a href="https://www.cnblogs.com/wuxl360/p/5817489.html" target="_blank" rel="noopener">https://www.cnblogs.com/wuxl360/p/5817489.html</a></p>
<pre><code> https://blog.csdn.net/ron03129596/article/details/68962448

http://cailin.iteye.com/blog/2014486</code></pre><p><strong>集群节点分配：</strong></p>
<table>
<thead>
<tr>
<th align="center">CentOS01</th>
<th align="center">CentOS02</th>
<th align="center">CentOS03</th>
<th align="center">CentOS04</th>
<th align="center">CentOS05</th>
</tr>
</thead>
<tbody><tr>
<td align="center">zookeeper</td>
<td align="center">zookeeper</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
</tr>
<tr>
<td align="center">NameNode</td>
<td align="center">NameNode (standby)</td>
<td align="center">DataNode</td>
<td align="center">DataNode</td>
<td align="center">DataNode</td>
</tr>
<tr>
<td align="center">ResourceManager</td>
<td align="center">ResourceM(standby)</td>
<td align="center">NodeManager</td>
<td align="center">NodeManager</td>
<td align="center">NodeManager</td>
</tr>
</tbody></table>
<p>由于5台虚拟主机中，CentOS01和CentOS02为名称结点，所以只需在它们上安装zookeeper。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">ZooKeeper是一个分布式的，开放源码的分布式应用程序协调服务，是Google的Chubby一个开源的实现，是Hadoop和Hbase的重要组件。它是一个为分布式应用提供一致性服务的软件，提供的功能包括：配置维护、域名服务、分布式同步、组服务等。</span><br><span class="line">ZooKeeper的基本运转流程：</span><br><span class="line">1、选举Leader。</span><br><span class="line">2、同步数据。</span><br><span class="line">3、选举Leader过程中算法有很多，但要达到的选举标准是一致的。</span><br><span class="line">4、Leader要具有最高的执行ID，类似root权限。</span><br><span class="line">5、集群中大多数的机器得到响应并follow选出的Leader。</span><br><span class="line">目前阿里开源的dubbo分布式服务框架推荐的注册中心。</span><br><span class="line">其更详细原理可以参考：http:&#x2F;&#x2F;cailin.iteye.com&#x2F;blog&#x2F;2014486&#x2F;</span><br></pre></td></tr></table></figure>

<p>接下来我们进入zookeeper的安装环节，zookeeper的安装总的来说比较简单，这里我准备了3台linux虚拟机，模拟集群环境，有条件的同学可以自己装3台（最少），其实集群和单机的区别不是太大，但是集群时节点数量一定是奇数（2n+1如3,5,7）。<br> 工具： CentOS.7，zookeeper-3.4.6，Xshell5</p>
<p><em>注：zookeeper本身由java编写，运行在java环境，故同学们必须先装好java环境，才可以继续zookeeper的安装，这里我对java环境不做讲解</em></p>
<h4 id="9-1-安装包下载或上传"><a href="#9-1-安装包下载或上传" class="headerlink" title="9.1  安装包下载或上传"></a>9.1  安装包下载或上传</h4><p><strong>教程：</strong>首先使用grid用户登录CentOS7_64_1，将zookeeper-3.4.6的安装包下载传至/home/grid目目录下<br> http下载路径: <a href="http://apache.fayea.com/zookeeper/" target="_blank" rel="noopener">http://apache.fayea.com/zookeeper/</a><br> linux命令下载：$ wget<br>  <a href="http://apache.fayea.com/zookeeper/zookeeper-3.4.6/zookeeper-3.4.6.tar.gz" target="_blank" rel="noopener">http://apache.fayea.com/zookeeper/zookeeper-3.4.6/zookeeper-3.4.6.tar.gz</a></p>
<p><strong>上传：</strong></p>
<p>使用filezilla把zookeeper上传到/home/work/software，用户名：root，密码：wuhuipei</p>
<h4 id="9-2-解压到上一节目录："><a href="#9-2-解压到上一节目录：" class="headerlink" title="9.2  解压到上一节目录："></a>9.2  解压到上一节目录：</h4><blockquote>
<p>tar -xvf zookeeper-3.4.7.tar.gz -C ../</p>
</blockquote>
<p>f压缩包位置 v打印每一步信息</p>
<h4 id="9-3-创建data和logs目录"><a href="#9-3-创建data和logs目录" class="headerlink" title="9.3  创建data和logs目录"></a>9.3  创建data和logs目录</h4><p>解压后进入zookeeper-3.4.7目录，创建data目录和logs目录，zookeeper默认是不带这两个目录的，需要用户自行创建并指定。 </p>
<blockquote>
<p>[root@CentOS01 zookeeper-3.4.7]# mkdir data<br>[root@CentOS01 zookeeper-3.4.7]# mkdir logs</p>
</blockquote>
<h4 id="9-4-创建myid文件"><a href="#9-4-创建myid文件" class="headerlink" title="9.4  创建myid文件"></a>9.4  创建myid文件</h4><p>在dataDir=/home/work/zookeeper-3.4.7/data下创建myid文件   </p>
<p>编辑myid文件，并在对应的IP的机器上输入对应的编号。如在第一台zookeeper上，我们给该myid文件内容指定就是1。如果只在单点上进行安装配置，那么只有一个server，后面讲集群的时候会有多态server故会有2,3,4…等等。  </p>
<blockquote>
<p>[root@CentOS01 data]# vim myid</p>
<p>1</p>
</blockquote>
<h4 id="9-5-复制修改配置文件"><a href="#9-5-复制修改配置文件" class="headerlink" title="9.5  复制修改配置文件"></a>9.5  复制修改配置文件</h4><p>接着进入zookeeper-3.4.6/conf目录下，将zoo_sample.cfg文件复制一份取名zoo.cfg  </p>
<blockquote>
<p>[root@CentOS01 conf]# cp zoo_sample.cfg zoo.cfg</p>
</blockquote>
<p><em>注：之所以取名zoo.cfg是因为这是启动时默认约定读取的</em> </p>
<p>修改zoo.cfg配置文件，如下：</p>
<p><img src="Hadoop/1536592271984.png" alt="1536592271984"></p>
<blockquote>
<p>dataDir=/home/work/zookeeper-3.4.7/data<br>dataLogDir=/home/work/zookeeper-3.4.7/logs<br>server.1=CentOS01:2888:3888</p>
</blockquote>
<p><strong>server.1=h1:2888:3888的解释如下：</strong></p>
<p>1是指一个数字，与前面创建的myid对应即可，标志这是第几台机器，CentOS01是我配置的映射名，大家可以直接将CentOS01改为自己的ip，如server.1=192.168.183.31:2888:3888； </p>
<p>2888 表示的是这个服务器与集群中的 Leader 服务器交换信息的端口，2888端口简单来说就是zookeeper服务之间的通信端口；    3888端口是与其他应用程序通信的端口 ，比如：leader掉线后，重新选举zookeeper</p>
<p> <strong>其他cfg参数说明：</strong></p>
<p><strong>tickTime=2000</strong>   </p>
<p>tickTime这个时间是作为Zookeeper服务器之间或客户端与服务器之间维持心跳的时间间隔,也就是每个tickTime时间就会发送一个心跳。 </p>
<p><strong>initLimit=10</strong><br> initLimit这个配置项是用来配置Zookeeper接受客户端（这里所说的客户端不是用户连接Zookeeper服务器的客户端,而是Zookeeper服务器集群中连接到Leader的Follower  服务器）初始化连接时最长能忍受多少个心跳时间间隔数。当已经超过10个心跳的时间（也就是tickTime）长度后Zookeeper  服务器还没有收到客户端的返回信息,那么表明这个客户端连接失败。总的时间长度就是10*2000=20 秒。</p>
<p><strong>syncLimit=5</strong><br> syncLimit这个配置项标识Leader与Follower之间发送消息,请求和应答时间长度,最长不能超过多少个tickTime的时间长度,总的时间长度就是5*2000=10秒。</p>
<p><strong>dataDir=/home/work/zookeeper-3.4.7/data</strong><br> dataDir顾名思义就是Zookeeper保存数据的目录,默认情况下Zookeeper将写数据的日志文件也保存在这个目录里。</p>
<p><strong>clientPort=2181</strong><br> clientPort这个端口就是客户端（应用程序）连接Zookeeper服务器的端口,Zookeeper会监听这个端口接受客户端的访问请求</p>
<h4 id="9-6-添加环境变量"><a href="#9-6-添加环境变量" class="headerlink" title="9.6  添加环境变量"></a>9.6  添加环境变量</h4><p>修改该用户下的.bash_profile文件，此文件默认为隐藏的   （这里只是为该用户配置全局变量，更好的选择是直接配置/etc/profile，为所有用户配置环境变量）</p>
<p>方一：</p>
<blockquote>
<p>[root@CentOS01 ~]# vim /root/.bash_profile，增加内容如下： </p>
<p>export ZOOKEEPER_HOME=/home/grid/zookeeper-3.4.6   </p>
<p>export PATH=$ZOOKEEPER_HOME/bin:$PATH   </p>
</blockquote>
<p>使配置文件生效：  </p>
<blockquote>
<p>[root@CentOS01 ~]# source /root/.bash_profile </p>
</blockquote>
<p>方二：</p>
<blockquote>
<p>[root@CentOS01 etc]# vim /etc/profile</p>
<p>JAVA_HOME=/home/work/jdk1.8.0_65<br>HADOOP_HOME=/home/work/hadoop-2.7.1<br>ZOOKEEPER_HOME=/home/work/zookeeper-3.4.7</p>
<p>PATH=$JAVA_HOME/bin:$PATH:$HADOOP_HOME/bin:$HADOOP_HOME/sbin:$ZOOKEEPER_HOME/bin<br>export JAVA_HOME PATH HADOOP_HOME ZOOKEEPER_HOME</p>
</blockquote>
<p>使配置文件生效：  </p>
<blockquote>
<p>[root@CentOS01 ~]# source /etc/profile </p>
</blockquote>
<p><strong>启动</strong>ZooKeeper的Server：zkServer.sh start；<strong>关闭</strong>ZooKeeper的Server：zkServer.sh stop </p>
<h4 id="9-7-防火墙配置"><a href="#9-7-防火墙配置" class="headerlink" title="9.7  防火墙配置"></a>9.7  防火墙配置</h4><p>在防火墙中打开要用到的端口，一般默认是开放了22端口，所以我们才能使用远程工具使用22进行连接，现在我们去配置2181 2888 3888端口，</p>
<p>使用root用户执行如下命令   chkconfig iptables on设置开机启动   </p>
<p>service iptables start 启动防火墙   <strong>我这里设置时就报错了，报错咱就得解决</strong> </p>
<p><img src="Hadoop/1536631101469.png" alt="1536631101469"></p>
<p><strong>解决方案</strong>：执行yum install iptables-services下载安装插件  </p>
<p><img src="Hadoop/1536631136357.png" alt="1536631136357"></p>
<p>安装完成后再次执行chkconfig iptables on，service iptables start命令  </p>
<p><img src="Hadoop/1536631230133.png" alt="1536631230133"></p>
<p><strong>我前面没有出错，所以直接到开放防火墙端口：</strong></p>
<p>接下来继续开放防火墙端口<br>[root@CentOS01 zookeeper-3.4.7]# vim /etc/sysconfig/iptables</p>
<p>复制22端口那一行3次，然后将端口修改为需要开放的3个，如下： </p>
<p><img src="Hadoop/1536631748114.png" alt="1536631748114"></p>
<blockquote>
<p>#zookeeper-2018-09-11-ron<br>-A INPUT -m state –state NEW -m tcp -p tcp –dport 2181 -j ACCEPT</p>
<p>-A INPUT -m state –state NEW -m tcp -p tcp –dport 2888 -j ACCEPT</p>
<p>-A INPUT -m state –state NEW -m tcp -p tcp –dport 3888 -j ACCEPT</p>
</blockquote>
<h4 id="9-8-重启防火墙"><a href="#9-8-重启防火墙" class="headerlink" title="9.8  重启防火墙"></a>9.8  重启防火墙</h4><ul>
<li><strong>不需要重启虚拟机</strong></li>
</ul>
<blockquote>
<p>[root@CentOS01 ~]# service iptables restart</p>
</blockquote>
<h4 id="9-9-开启zookeeper服务"><a href="#9-9-开启zookeeper服务" class="headerlink" title="9.9  开启zookeeper服务"></a>9.9  开启zookeeper服务</h4><p>启动并测试zookeeper（当初使用root用户解压安装的，所以需要使用root用户启动），在zookeeper目录的bin下面执行   </p>
<p>[root@CentOS01 bin]# ./zkServer.sh start</p>
<p>** 因为没配置环境变量，所以需要加上当前目录  ./  ，当初就是进了这个坑** </p>
<p>执行jps查看状态，其中QuorumPeerMain是zookeeper进程，启动正常  </p>
<p><img src="Hadoop/1536632279086.png" alt="1536632279086"></p>
<p>查看zookeeper服务输出信息，其日志信息文件在   /home/work/zookeeper-3.4.7/bin/zookeeper.out   tail -222f zookeeper.out查看 ，ctrl +  z  退出</p>
<h4 id="9-10-设置服务为开机启动"><a href="#9-10-设置服务为开机启动" class="headerlink" title="9.10  设置服务为开机启动"></a>9.10  设置服务为开机启动</h4><p>教程：<a href="https://blog.csdn.net/u012453843/article/details/70162796/" target="_blank" rel="noopener">https://blog.csdn.net/u012453843/article/details/70162796/</a></p>
<p>例子：</p>
<!--配置zookeeper为grid用户开机启动，不然在生产环境会很麻烦--> 

<p><img src="Hadoop/1536632767416.png" alt="1536632767416"></p>
<!--编辑/etc/rc.local文件，加入：--> 
<p> su - grid -c ‘/home/grid/zookeeper-3.4.6/bin/zkServer.sh start’</p>
<!--**注：su -- grid是指切换到grid用户，-c是指调用后面命令**-->

<p><strong>两种方法：</strong></p>
<p>*<em>方法一：直接修改/etc/rc.d/rc.local文件 *</em></p>
<p>在/etc/rc.d/rc.local文件中需要输入两行，其中export JAVA_HOME=/home/work/jdk1.8.0_65是必须要有的，否则开机启动不成功，大家根据自己JDK安装的位置自行更改。另一行/home/work/zookeeper-3.4.7/bin/zkServer.sh start则是我们zookeeper的启动命令。配置好之后，重启虚拟机，会发现已经可以开机自启了。 </p>
<p><img src="Hadoop/1536638914434.png" alt="1536638914434"></p>
<h4 id="拓展："><a href="#拓展：" class="headerlink" title="拓展："></a>拓展：</h4><p><strong>CentOS 中设置服务开机自启：</strong></p>
<p>教程：<a href="https://blog.csdn.net/jack_nichao/article/details/54093394" target="_blank" rel="noopener">https://blog.csdn.net/jack_nichao/article/details/54093394</a></p>
<p><strong>方法一：ln -s 建立软连接</strong></p>
<p>在CentOS中总共有7中运行级别，可以在/etc/inittab文件中进行设置，7种运行级别对应着/etc/rc.d/rc[0-6].d 这7个目录 </p>
<p><img src="Hadoop/1536634555321.png" alt="1536634555321"></p>
<p><strong>ps: 你可能也发现了在/etc下也有同样的7个文件夹即 /etc/rc[0-6].d ，通过查看发现/etc/rc[0-6].d其实就是/etc/rc.d/rc[0-6].d的软连接，只是为了保持和Unix的兼容性</strong> </p>
<p><img src="Hadoop/1536634575950.png" alt="1536634575950"></p>
<p>这7个目录对应着7种不同运行级别，也就是说在每一个目录下的内容表示在该运行级别下应该启动或者关闭的服务。例如我们看一下/etc/rc.d/rc5.d目录下的内容 </p>
<p><img src="Hadoop/1536634606672.png" alt="1536634606672"></p>
<p>当然你可能也发现了，这些文件是按照如下格式命名的 <strong>[KS][1-100]servicename</strong> ，它表示当系统的运行级别为5时，它会关掉以K开头的所有服务，并启动所有以S开头的服务，其实，这些服务都是/etc/init.d/中某个服务的软连接，所以真正启动的服务是/etc/init.d目录中的某一个服务，而以K/S开头建立软连接是为了表明在对应级别下应该采取的行为，K/S后面紧跟的数字表示开/关服务的优先级。</p>
<p>因此，如果我们自己写了一个脚本代码 如<strong>cleanupd</strong>，需要在开机级别为3的时候自启动的话，那么我们只需要把可执行的<strong>cleanupd</strong>脚本文件放到 /etc/init.d目录下，并在对应的运行级别目录下 如/etc/rc.d/rc3.d/ 建立一个以S开头后加数字的软连接到/etc/init.d/cleanupd即可，如</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@nichao ~]# ln -s &#x2F;etc&#x2F;init.d&#x2F;cleanupd &#x2F;etc&#x2F;rc.d&#x2F;rc3.d&#x2F;S95cleanup1</span><br></pre></td></tr></table></figure>

<p>显然，这样的设置方式比较繁琐，仅仅适合于我们想DIY的脚本服务。</p>
<p>** 方法二：chkconfig**</p>
<p>鉴于上面的手工操作比较繁琐，在CentOS中专门提供了chkconfig 命令来设置或者取消开机自启动服务。 </p>
<p><img src="Hadoop/1536634685208.png" alt="1536634685208"></p>
<p>使用chkconfig  或者 chkconfig –list就可以看出当前系统已经设置的各个服务在各个运行级别下的开闭状态。如果我们想设置某个服务自启动或者关闭的话，那么只需要按照下面的格式使用即可</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chkconfig servicename on&#x2F;off</span><br></pre></td></tr></table></figure>

<p><img src="Hadoop/1536634722606.png" alt="1536634722606"></p>
<p>如上图可以看到，我们设置sshd服务开机自启，但是它的缺省自启的运行级别是在2345上的，我们可以在设置的时候加上–level 参数来明确表明需要在哪些级别上自启。   如：chkconfig –level 35 sshd on  表示在级别3和5上开机自启动 </p>
<p><img src="Hadoop/1536634739647.png" alt="1536634739647"></p>
<p>如图所示，在级别为3 5的时候，sshd服务被设置为启动状态，而2 4 级别则设置为关闭状态。 </p>
<h4 id="9-11-两台虚拟机完成以上操作"><a href="#9-11-两台虚拟机完成以上操作" class="headerlink" title="9.11  两台虚拟机完成以上操作"></a>9.11  两台虚拟机完成以上操作</h4><h4 id="9-12-修改防火墙端口"><a href="#9-12-修改防火墙端口" class="headerlink" title="9.12  修改防火墙端口"></a>9.12  修改防火墙端口</h4><p>接下来配置2台服务器的端口，防火墙那一块改为下面对应的端口 </p>
<blockquote>
<p>[root@CentOS01 zookeeper-3.4.7]# vim /etc/sysconfig/iptables</p>
</blockquote>
<p><strong>机器1—端口：2181,2881,3881</strong> </p>
<p><img src="Hadoop/1536639126431.png" alt="1536639126431"></p>
<p><strong>机器2—端口：2182,2882,3882</strong> </p>
<p><img src="Hadoop/1536639214615.png" alt="1536639214615"></p>
<p><strong>机器3—端口：2183,2883,3883</strong> </p>
<ul>
<li><strong>不需要重启虚拟机</strong></li>
</ul>
<blockquote>
<p>[root@CentOS01 ~]# service iptables restart</p>
</blockquote>
<h4 id="9-13-zookeeper配置"><a href="#9-13-zookeeper配置" class="headerlink" title="9.13  zookeeper配置"></a>9.13  zookeeper配置</h4><blockquote>
<p>[root@CentOS02 sysconfig]# cd /home/work/zookeeper-3.4.7/conf/<br>[root@CentOS02 conf]# vim zoo.cfg       3台机器注意注意<strong>端口号</strong>参数  </p>
</blockquote>
<p><strong>centOS01:</strong></p>
<blockquote>
<p>dataDir=/home/work/zookeeper-3.4.7/data<br>dataLogDir=/home/work/zookeeper-3.4.7/logs</p>
<p>server.1=CentOS01:2881:3881<br>server.2=CentOS02:2882:3882</p>
<p>server.3=CentOS03:2883:3883</p>
<p>clientPort=2181</p>
</blockquote>
<p><strong>CentOS02:</strong></p>
<blockquote>
<p>dataDir=/home/work/zookeeper-3.4.7/data<br>dataLogDir=/home/work/zookeeper-3.4.7/logs<br>server.1=CentOS01:2881:3881<br>server.2=CentOS02:2882:3882</p>
<p>server.3=CentOS03:2883:3883</p>
<p>clientPort=2182</p>
</blockquote>
<p><strong>CentOS03:</strong></p>
<blockquote>
<p>dataDir=/home/work/zookeeper-3.4.7/data<br>dataLogDir=/home/work/zookeeper-3.4.7/logs<br>server.1=CentOS01:2881:3881<br>server.2=CentOS02:2882:3882</p>
<p>server.3=CentOS03:2883:3883</p>
<p>clientPort=2183</p>
</blockquote>
<p><strong>server.A=B：C：D</strong></p>
<p>A：其中 A 是一个数字，表示这个是服务器的编号；<br>B：是这个服务器的 ip 地址；<br>C：Leader选举的端口；<br>D：Zookeeper服务器之间的通信端口</p>
<p><strong>在dataDir=/home/work/zookeeper-3.4.7/data下，修改data文件夹下的myid文件的值，</strong></p>
<p><strong>分别对应的值为1，2，3</strong></p>
<h4 id="9-14-启动zookeeper"><a href="#9-14-启动zookeeper" class="headerlink" title="9.14  启动zookeeper"></a>9.14  启动zookeeper</h4><p><strong>启动</strong>ZooKeeper的Server：zkServer.sh start；<strong>关闭</strong>ZooKeeper的Server：zkServer.sh stop </p>
<p><strong>发现问题：</strong></p>
<p>启动zkServer.sh start 后显示是启动了，jps下也是有线程 ,说明线程启动成功，并没有端口占用的问题，但是在我 zkServer.sh status 就会出现It is probably not running的错误。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@CentOS01 conf]# jps</span><br><span class="line"></span><br><span class="line">2631 Jps</span><br><span class="line"></span><br><span class="line">2536 QuorumPeerMain</span><br><span class="line"></span><br><span class="line">[root@CentOS01 conf]# zkServer.sh status</span><br><span class="line"></span><br><span class="line">ZooKeeper JMX enabled by default</span><br><span class="line"></span><br><span class="line">Using config: &#x2F;home&#x2F;work&#x2F;zookeeper-3.4.7&#x2F;bin&#x2F;..&#x2F;conf&#x2F;zoo.cfg</span><br><span class="line"></span><br><span class="line">Error contacting service. It is probably not running.</span><br></pre></td></tr></table></figure>

<p>解决方法：</p>
<ol>
<li>查看liunx系统的防火墙是否关闭，查看防火墙状态 service iptables status 如果没有关闭，就 service iptables stop 关闭防火墙，然后重新启动zookeeper 看是否启用成功。  </li>
</ol>
<ol start="2">
<li><p>zoo.cfg里面配置数据，对应需要改的数据根据自身的需求改，然后在zookeeper中创建相应data和log文件，一定别忘了在data目录下创建myid.  </p>
<p><strong>创建数据目录,也就是在你zoo.cfg配置文件里dataDir指定的那个目录下创建myid文件,并且指定id,改id为你zoo.cfg文件server.1=localhost:2888:3888中的    1.只要在myid头部写入1即可.</strong>   </p>
<p>注:在我第二次安装的时候，没有将myid文件创建在dataDir指定的那个目录下，也报了该错误。之后在dataDir指定的那个目录下创建myid文件就没有报错。 </p>
</li>
<li><p>最后一点也是最重要的一点，出错后一点要查看zookeeper.out文件，进行错误排查，这样才能知道自己到底出的是什么错误，好对症下药。 </p>
<p>查看zookeeper服务输出信息，其日志信息文件在   /home/work/zookeeper-3.4.7/bin/zookeeper.out   tail -222f zookeeper.out查看 ，ctrl +  z  退出</p>
</li>
</ol>
<p><strong>zookeeper搭建集群，需要虚拟机最少3台，给3台虚拟机配置好zookeeper，问题解决！！！！</strong></p>
<p>按照步骤，一个一个排查就可以了。</p>
<h3 id="10-配置CentOS01节点的hadoop"><a href="#10-配置CentOS01节点的hadoop" class="headerlink" title="10.  配置CentOS01节点的hadoop"></a>10.  配置CentOS01节点的hadoop</h3><h4 id="10-1-配置hadoop-env-sh"><a href="#10-1-配置hadoop-env-sh" class="headerlink" title="10.1  配置hadoop-env.sh"></a>10.1  配置hadoop-env.sh</h4><ol>
<li>进入/home/work/hadoop-2.7.1/etc/hadoop</li>
<li>打开hadoop-env.sh，vim hadoop-env.sh</li>
<li>配置jdk安装所在目录</li>
<li>配置hadoop文件所在目录</li>
</ol>
<blockquote>
<p>export JAVA_HOME=/home/work/jdk1.8.0_65</p>
<p>export HADOOP_CONF_DIR=/home/work/hadoop-2.7.1/etc/hadoop</p>
</blockquote>
<h4 id="10-2-配置core-site-xml"><a href="#10-2-配置core-site-xml" class="headerlink" title="10.2  配置core-site.xml"></a>10.2  配置core-site.xml</h4><blockquote>
<configuration>
     <!--用来指定hdfs的老大，ns为固定属性名，表示两个namenode-->
     <property>
             <name>fs.defaultFS</name>
             <value>hdfs://ns</value>
     </property>
     <!--用来指定hadoop运行时产生文件的存放目录-->
     <property>
             <name>hadoop.tmp.dir</name>
             <value>/home/work/hadoop-2.7.1/tmp</value>
     </property>
     <!--执行zookeeper地址-->
     <property>
             <name>ha.zookeeper.quorum</name>
             <value>CentOS01:2181,CentOS02:2182,CentOS03:2183</value>
     </property>
</configuration>
</blockquote>
<h4 id="10-3-配置hdfs-site-xml"><a href="#10-3-配置hdfs-site-xml" class="headerlink" title="10.3  配置hdfs-site.xml"></a>10.3  配置hdfs-site.xml</h4><blockquote>
<configuration>
     <!--执行hdfs的nameservice为ns,和core-site.xml保持一致-->
     <property>
             <name>dfs.nameservices</name>
             <value>ns</value>
     </property>
     <!--ns下有两个namenode,分别是nn1,nn2-->
     <property>
             <name>dfs.ha.namenodes.ns</name>
             <value>nn1,nn2</value>
     </property>
     <!--nn1的RPC通信地址-->
     <property>
             <name>dfs.namenode.rpc-address.ns.nn1</name>
             <value>CentOS01:9000</value>
     </property>
     <!--nn1的http通信地址-->
             <value>nn1,nn2</value>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;&#x2F;property&gt;</span><br><span class="line">&lt;!--nn1的RPC通信地址--&gt;</span><br><span class="line">&lt;property&gt;</span><br><span class="line">        &lt;name&gt;dfs.namenode.rpc-address.ns.nn1&lt;&#x2F;name&gt;</span><br><span class="line">        &lt;value&gt;CentOS01:9000&lt;&#x2F;value&gt;</span><br><span class="line">&lt;&#x2F;property&gt;</span><br><span class="line">&lt;!--nn1的http通信地址--&gt;</span><br><span class="line">&lt;property&gt;</span><br><span class="line">        &lt;name&gt;dfs.namenode.http-address.ns.nn1&lt;&#x2F;name&gt;</span><br><span class="line">        &lt;value&gt;CentOS01:50070&lt;&#x2F;value&gt;</span><br><span class="line">&lt;&#x2F;property&gt;</span><br><span class="line">&lt;!--nn2的RPC通信地址--&gt;</span><br><span class="line">&lt;property&gt;</span><br><span class="line">        &lt;name&gt;dfs.namenode.rpc-address.ns.nn2&lt;&#x2F;name&gt;</span><br><span class="line">        &lt;value&gt;CentOS02:9000&lt;&#x2F;value&gt;</span><br><span class="line">&lt;&#x2F;property&gt;</span><br></pre></td></tr></table></figure>

<p>​    <!--nn2的http通信地址--><br>​     <property><br>​             <name>dfs.namenode.http-address.ns.nn2</name><br>​             <value>CentOS02:50070</value><br>​     </property><br>​     <!--指定namenode的元数据在JournalNode上的存放位置,这样，namenode2可以 从jn集群里获取
​               最新的namenode的信息，达到热备的效果--><br>​     <property><br>​             <name>dfs.namenode.shared.edits.dir</name><br>​             <value> qjournal://CentOS03:8485;CentOS04:8485;CentOS05:8485/ns</value><br>​     </property><br>​     <!--指定JournalNode存放数据的位置--><br>​     <property><br>​             <name>dfs.journalnode.edits.dir</name><br>​             <value>/home/work/hadoop-2.7.1/journal</value><br>​     </property><br>​     <!--开启 namenode 故障时自动切换--><br>​     <property></p>
<p>​            <name>dfs.ha.automatic-failover.enabled</name><br>​             <value>true</value><br>​     </property><br>​     <!--配置切换的实现方式--><br>​     <property><br>​             <name>dfs.client.failover.proxy.provider.ns</name><br>​             <value> org.apache.hadoop.hdfs.server.namenode.ha.ConfiguredFailoverProxyProv ider</value><br>​     </property><br>​     <!--配置隔离机制--><br>​     <property><br>​             <name>dfs.ha.fencing.methods</name><br>​             <value>sshfence</value><br>​     </property><br>​     <!--配置隔离机制的ssh登录秘钥所在的位置--><br>​     <property><br>​             <name>dfs.ha.fencing.ssh.private-key-files</name></p>
<p>​            <value>/root/.ssh/id_rsa</value><br>​     </property><br>​     <!--配置namenode数据存放的位置,可以不配置，如果不配置，默认用的是
​               core-site.xml里配置的hadoop.tmp.dir的路径--><br>​     <property><br>​             <name>dfs.namenode.name.dir</name><br>​             <value>file:///home/work/hadoop-2.7.1/tmp/namenode</value><br>​     </property><br>​     <!--配置datanode数据存放的位置,可以不配置，如果不配置，默认用的是
​            core-site.xml里配置的hadoop.tmp.dir的路径--><br>​     <property><br>​             <name>dfs.datanode.data.dir</name><br>​             <value>file:///home/work/hadoop-2.7.1/tmp/datanode</value><br>​     </property><br>​     <!--配置block副本数量--><br>​     <property><br>​             <name>dfs.replication</name><br>​             <value>3</value></p>
<p>​    </property><br>​     <!--设置 hdfs 的操作权限， false 表示任何用户都可以在 hdfs 上操作文件--><br>​     <property><br>​             <name>dfs.permissions</name><br>​             <value>false</value><br>​     </property><br></configuration></p>
</blockquote>
<h4 id="10-4-配置mapred-site-xml"><a href="#10-4-配置mapred-site-xml" class="headerlink" title="10.4  配置mapred-site.xml"></a>10.4  配置mapred-site.xml</h4><p>先把mapred-site.xml.template复制一份，并命名mapred-site.xml</p>
<blockquote>
<configuration>
     <property>
     <!--指定mapreduce运行在yarn上-->
             <name>mapreduce.framework.name</name>
             <value>yarn</value>
     </property>
</configuration>
</blockquote>
<h4 id="10-5-配置yarn-site-xml"><a href="#10-5-配置yarn-site-xml" class="headerlink" title="10.5  配置yarn-site.xml"></a>10.5  配置yarn-site.xml</h4><blockquote>
<configuration>
     <!-- Site specific YARN configuration properties -->
     <!--开启YARN HA -->
     <property>
             <name>yarn.resourcemanager.ha.enabled</name>
             <value>true</value>
     </property>
     <!--指定两个 resourcemanager 的名称-->
     <property>
             <name>yarn.resourcemanager.ha.rm-ids</name>
             <value>rm1,rm2</value>
     </property>
     <!--配置rm1，rm2的主机-->
     <property>
             <name>yarn.resourcemanager.hostname.rm1</name>
             <value>CentOS01</value>
      </property>
         <property>
                 <name>yarn.resourcemanager.hostname.rm2</name>
                 <value>CentOS02</value>
         </property>
         <!--开启yarn恢复机制-->
         <property>
                 <name>yarn.resourcemanager.recovery.enabled</name>
                 <value>true</value>
         </property>
         <!--执行rm恢复机制实现类-->
         <property>
                 <name>yarn.resourcemanager.store.class</name>
                 <value>org.apache.hadoop.yarn.server.resourcemanager.recovery.ZKRMStateStore </value>
         </property>
         <!--配置zookeeper的地址-->
         <property>
                 <name>yarn.resourcemanager.zk-address</name>
 <value>CentOS01:2181,CentOS02:2182,CentOS03:2183</value>
                 <description>For multiple zk services, separate them with comma</description>
         </property>
         <!--指定YARN HA的名称-->
         <property>
                 <name>yarn.resourcemanager.cluster-id</name>
                 <value>yarn-ha</value>
         </property>
         <property>
         <!--指定yarn的老大resoucemanager的地址-->
                 <name>yarn.resourcemanager.hostname</name>
                 <value>CentOS02</value>
         </property>
         <property>
         <!--NodeManager 获取数据的方式-->
                 <name>yarn.nodemanager.aux-services</name>
                 <value>mapreduce_shuffle</value>
         </property>
 </configuration>
</blockquote>
<h4 id="10-6-配置slaves文件"><a href="#10-6-配置slaves文件" class="headerlink" title="10.6  配置slaves文件"></a>10.6  配置slaves文件</h4><blockquote>
<p>CentOS03<br>CentOS04<br>CentOS05</p>
</blockquote>
<h4 id="10-7-配置hadoop环境变量-已经配好了"><a href="#10-7-配置hadoop环境变量-已经配好了" class="headerlink" title="10.7  配置hadoop环境变量(已经配好了)"></a>10.7  配置hadoop环境变量(已经配好了)</h4><h4 id="10-8-根据配置文件，创建相关文件夹，用于存放对应数据"><a href="#10-8-根据配置文件，创建相关文件夹，用于存放对应数据" class="headerlink" title="10.8  根据配置文件，创建相关文件夹，用于存放对应数据"></a>10.8  根据配置文件，创建相关文件夹，用于存放对应数据</h4><p>在hadoop-2.7.1目录下创建:</p>
<p>①journal目录</p>
<p>②创建tmp目录</p>
<p>③在tmp目录下，分别创建namenode目录和datanode目录</p>
<h4 id="10-9-通过scp命令，将hadoop安装目录远程copy到其他4台主机上"><a href="#10-9-通过scp命令，将hadoop安装目录远程copy到其他4台主机上" class="headerlink" title="10.9  通过scp命令，将hadoop安装目录远程copy到其他4台主机上"></a>10.9  通过scp命令，将hadoop安装目录远程copy到其他4台主机上</h4><blockquote>
<p>scp -r hadoop-2.7.1/ root@CentOS05:/home/work/</p>
</blockquote>
<h3 id="一般在那么node配置好hadoop配置文件，再发给各个节点！！"><a href="#一般在那么node配置好hadoop配置文件，再发给各个节点！！" class="headerlink" title="一般在那么node配置好hadoop配置文件，再发给各个节点！！"></a>一般在那么node配置好hadoop配置文件，再发给各个节点！！</h3>
      
    </div>

    
    
    
	<div>
		
	</div>
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

  </div>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Anderson Wu"
      src="/images/self.png">
  <p class="site-author-name" itemprop="name">Anderson Wu</p>
  <div class="site-description" itemprop="description">Love is love</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">20</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">标签</span>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Anderson Wu</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
